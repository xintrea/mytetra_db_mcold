<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:29px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Gudea,sans-serif'; font-size:medium; font-weight:600; color:#404040; text-transform:uppercase;">ЗАМЕЧАНИЕ</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">В GTK+ версии 2.0, система сигналов была перемещена в GLib. Мы не хотим углубляться в детали различий между системой сигналов GLib 2.0 и системой сигналов GTK+ 1.2. Эти различия не должны повлиять на работу с PyGTK.</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">До подробного разбора </span><a href="http://pygtk.rosix.ru/pygtk2tutorial/examples/helloworld.py"><span style=" font-family:'inherit'; font-size:16px; font-weight:600; color:#3d7b60;">helloworld.py</span></a><span style=" font-family:'inherit'; font-size:16px; color:#404040;">, мы поговорим о сигналах и обратных вызовах. GTK+ основан на событиях, это означает, что выполнение в </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">gtk.main</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">() временно приостанавливается до тех пор пока не случится событие, и управление будет передано обрабатывающей функции.</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Эта передача управления происходит благодаря идее “Сигналов” (заметим, что эти сигналы не такие, как системные сигналы Unix, и неспособны их использовать, хотя терминология полностью идентична). Когда происходит событие, такое как нажатие на кнопку мыши, то соответствующий сигнал будет “излучаться” нажатым виджетом. Таким образом GTK+ выполняет большую часть работы. Есть сигналы наследуемые всеми виджетами, такие как “destroy”, а есть специфичные сигналы, например, “toggled” для переключателя.</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Чтобы кнопка выполняла действие, мы должны установить обработчик сигнала для того, чтобы отлавливать нужный нам сигнал и вызывать соответствующую функцию. Это делается использованием метода </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">connect</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> (из класса </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">GObject</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">) таким образом:</span></p>
<table border="0" style=" border-color:#b7c7bd; border-style:solid; margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0" bgcolor="#e0e0e0">
<tr>
<td bgcolor="#f0f6ea" style=" padding-left:10; padding-right:10; padding-top:5; padding-bottom:5;">
<pre style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Courier 10 Pitch,Courier,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">  handler_id = object.connect(name, func, func_data)</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Где object является экземпляром </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">GtkWidget</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> (любым виджетом)</span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> который будет излучать сигнал. Первый параметр </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">name</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> – это строка, содержащая имя сигнала для перехвата. Вторым параметром </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">func</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> является функция, которая должна быть вызвана при получении сигнала. Третьим параметром </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">func_data</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> передаются параметры, которые нужно передать в функцию. Метод возвращает handler_id который может быть использован для отключения или блокировки обработчика.</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Функция, указанная вторым параметром, называется “Функция обратного вызова” (далее по тексту, возможно, вы встретите английское обозначение “Callback”), и должна быть в следующей форме:</span></p>
<table border="0" style=" border-color:#b7c7bd; border-style:solid; margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0" bgcolor="#e0e0e0">
<tr>
<td bgcolor="#f0f6ea" style=" padding-left:10; padding-right:10; padding-top:5; padding-bottom:5;">
<pre style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Courier 10 Pitch,Courier,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">  def callback_func(widget, callback_data):</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Здесь первым аргументом является указатель на </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">widget</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> который излучает сигнал. Вторым (</span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">callback_data</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">) – указатель на данные, полученные последним аргументом к методу </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">connect</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">(), показанному выше.</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Если функция обратного вызова является методом объекта, тогда она должна быть в общей форме:</span></p>
<table border="0" style=" border-color:#b7c7bd; border-style:solid; margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0" bgcolor="#e0e0e0">
<tr>
<td bgcolor="#f0f6ea" style=" padding-left:10; padding-right:10; padding-top:5; padding-bottom:5;">
<pre style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Courier 10 Pitch,Courier,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">  def callback_meth(self, widget, callback_data):</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">где </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">self</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> экземпляр объекта, выполняющего метод. Функция такого вида использована в примере </span><a href="http://pygtk.rosix.ru/pygtk2tutorial/examples/helloworld.py"><span style=" font-family:'inherit'; font-size:16px; font-weight:600; color:#3d7b60;">helloworld.py</span></a><span style=" font-family:'inherit'; font-size:16px; color:#404040;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Gudea,sans-serif'; font-size:medium; font-weight:600; color:#404040; text-transform:uppercase;">ЗАМЕЧАНИЕ</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Форма функций обратного вызова показанная выше применяется в большинстве случаев, но некоторые специальные сигналы генерируют другие параметры вызова</span></p>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">Другой вызов использован в примере </span><a href="http://pygtk.rosix.ru/pygtk2tutorial/examples/helloworld.py"><span style=" font-family:'inherit'; font-size:16px; font-weight:600; color:#3d7b60;">helloworld.py</span></a><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> так:</span></p>
<table border="0" style=" border-color:#b7c7bd; border-style:solid; margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0" bgcolor="#e0e0e0">
<tr>
<td bgcolor="#f0f6ea" style=" padding-left:10; padding-right:10; padding-top:5; padding-bottom:5;">
<pre style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Courier 10 Pitch,Courier,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">  handler_id = object.connect_object(name, func, slot_object)</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">connect_object</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">() похож на </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">connect</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">() за тем исключением, что функция обратного вызова использует только один аргумент, и метод callback для аргумента:</span></p>
<table border="0" style=" border-color:#b7c7bd; border-style:solid; margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0" bgcolor="#e0e0e0">
<tr>
<td bgcolor="#f0f6ea" style=" padding-left:10; padding-right:10; padding-top:5; padding-bottom:5;">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Courier 10 Pitch,Courier,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">  def callback_func(object)</span></pre>
<pre style=" margin-top:0px; margin-bottom:22px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f0f6ea;"><span style=" font-family:'Courier 10 Pitch,Courier,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">  def callback_meth(self, object)</span></pre></td></tr></table>
<p style=" margin-top:0px; margin-bottom:29px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; color:#404040;">где </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">object</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;"> обычно является виджетом. </span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">connect_object</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">() позволяет методам виджетов PyGTK получая только один аргумент (</span><span style=" font-family:'Monaco,Consolas,Andale Mono,DejaVu Sans Mono,monospace'; font-size:16px; color:#404040; background-color:#f0f6ea;">self</span><span style=" font-family:'inherit'; font-size:16px; color:#404040;">) использовать обработчики сигналов.</span></p></body></html>