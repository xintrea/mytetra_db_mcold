<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:11px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:xx-large; font-weight:496; color:#343434;">Развёртывание репозиториев Linux</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:13px; color:#5e6973;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:8px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/hub/sys_admin/"><span style=" font-size:13px; background-color:transparent;">Системное администрирование</span></a><span style=" font-size:13px;">,</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:13px; color:#5e6973;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:8px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/hub/linux/"><span style=" font-size:13px; background-color:transparent;">Настройка Linux</span></a><span style=" font-size:13px;">,</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:13px; color:#5e6973;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:8px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/hub/nix/"><span style=" font-size:13px; background-color:transparent;">*nix</span></a></li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:14px; color:#333333;" style=" margin-top:7px; margin-bottom:4px; margin-left:0px; margin-right:8px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/info/help/karma/#recovery"><span style=" font-size:12px; color:#6667a3; background-color:transparent;">Recovery Mode</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; color:#222222; background-color:#ffffff;">Без синхронизаций и т.д., в варианте «есть хостинг» или «файловая помойка» и надо быстро выкатить хранилище пакетов для дистрибутива Linux (так чтобы можно было подключиться к этому репозиторию и поставить оттуда всё необходимое). Иногда обновляться в ручном режиме — копированием по тому же адресу с перезаписью. Раз в полгода или год. Задача типовая и я её опишу в полуавтоматическом режиме.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; font-weight:496; color:#548eaa;">Репозиторий RHEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; font-weight:496; color:#548eaa;">Репозиторий Debian</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;">1. Создаём ключ DEB-GPG-KEY. Стандартно.<br /></span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#c18401; background-color:#fbfdff;">cd</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;"> ~</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ gpg --gen-key</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ gpg --export -a </span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#50a14f; background-color:#fbfdff;">'Name Surname (repo)'</span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;"> &gt; DEB-GPG-KEY</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;"><br />2. Создаём файл ~/.rpmmacros следующего содержания:<br /></span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">%_signature gpg</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">%_gpg_path ~/.gnupg</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">%_gpg_name Name Surname (repo)</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;"><br />3. Создаём директорию repo, а в ней директории dists и pool. В них уже будет система каталогов. Переносим туда ключ DEB-GPG-KEY<br /></span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ mkdir -p repo/dists/nobody/soft/binary-i386</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ mkdir -p repo/dists/nobody/soft/binary-x86_64</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ mkdir -p repo/pool/soft/binary-i386/t/teamviewer</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ mkdir -p repo/pool/soft/binary-x86_64/t/teamviewer</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ mv DEB-GPG-KEY repo/DEB-GPG-KEY</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;"><br />4. В директории dists у нас будут храниться данные о пакетах, а в директории pool — сами пакеты. Причём из имени /binary-i386/t/teamviewer уже видно, что пакеты раскладываются по архитектурам, затем по буквенным директориям и затем по директориям с именами происходящими от названия содержащегося в них ПО (в них может лежать десяток пакетов необходимых конкретному ПО по его зависимостям). Т.е. имеется заданная иерархия.<br /><br />5. Кладём в директорию repo </span><a href="http://pastebin.com/vmYVgug1"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; text-decoration: underline; color:#487284; background-color:transparent;">скрипт для подготовки репозитория</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;">. Меняем в первой строчке скрипта key_pass=«password» на пароль Вашего ключа.<br /><br />6. Запускаем скрипт и ждём когда он отработает.<br /></span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ chmod a+x</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ ./repo_debian.sh</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;"><br />7. Закачиваем на хостинг директорию repo и описываем репозиторий в /etc/apt/sources.list<br /></span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">deb http://&lt;IP-адрес&gt;/repo nobody soft</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:16px; color:#222222;"><br />8. Проверяем работу репозитория<br /></span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ wget http://&lt;IP-адрес&gt;/repo/DEB-GPG-KEY</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ sudo apt-key add DEB-GPG-KEY</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ sudo apt-get clean</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#383a42; background-color:#fbfdff;">$ sudo apt-get update</span></pre></body></html>