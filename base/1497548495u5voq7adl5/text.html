<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> let s:count = line(&quot;$&quot;)                                           -- считаем количество строк в файле                                                </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  2                                                                             </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  3 let s:line1 = &quot;--------------&quot;                                               </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  4 let s:line2 = printf(&quot;Lines count : %d&quot;, s:count)                         </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  5                                                                              </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  6 call append(s:count, [s:line1, s:line2])                                    </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  7                                                                              </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  8 unlet s:count s:line1 s:line2</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">А теперь рассмотрим построчно скрипт примера.</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">В начале мы получаем количество строк в текущем буфере с помощью встроенной функции</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">line()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">. В зависимости от строки, переданной в качестве аргумента этой функции, </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">line()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> может выполнять разные задачи. Если ей передать строку &quot;$&quot;, как в данном примере, то мы получим количество строк в буфере. Если передать параметр &quot;.&quot;, то функция вернет номер строки, на которой находится курсор. Так же с помощью этой функции можно получать номера строк для установленных меток. Подробнее про эту функцию и ее аргументы советую почитать в справке:</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">:help line</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">Многие другие функции используют те же строки-параметры, что и функция</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">line()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">.</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">После того, как мы узнали количество строк, создаются две строковые переменные, первая из них</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">s:line1</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> содержит просто несколько знаков '-', чтобы отделить текст буфера от будущего количества строк, а вторая переменная </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">s:line2</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> содержит текст с количеством строк. Как вы поняли, переменные эти видимы только внутри скрипта. Многие из вас, наверное, обрадовались, увидев знакомую с детства по языкам C/C++ функцию </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">printf()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">. Работает она почти точно так же (только функция </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">printf</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> здесь возвращает полученную строку, а не выводит ее на экран), поэтому про нее тоже не стоит долго рассказывать, тем более, что про одну эту функцию можно написать целую статью. Тех, кто не знаком с этой замечательной функцией, отправлю в справку, где про нее все подробно написано:</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">:help printf</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">Затем мы используем другую новую для нас функцию Vim -</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">append()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">, которая добавляет строку или строки в текущий буфер. Первый ее параметр определяет номер строки, после которой нам нужно вставить новые строки, а второй аргумент должен быть строкой или списком строк, которые будут добавлены. В нашем примере мы используем список, составленный из только что созданных строк </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">s:line1</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> и </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">s:line2</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">.</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">Обратите внимание на команду</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">call</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">, которая обозначает, что мы хотим вызвать функцию, которая следует за ним. Как я уже говорил, наличие этого оператора необходимо из-за того, что в начале строки обязательно должен быть какой-нибудь оператор. Так как функция </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">append()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> значение 1 в случае невозможности добавления строк, и 0 при их успешном добавлении, то мы могли бы переписать эту строку следующим образом:</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#f1f0ed;"><a name="sourceblock16"></a><span style=" font-family:'monospace'; font-size:small; color:#804040;">l</span><span style=" font-family:'monospace'; font-size:small; color:#804040;">et</span><span style=" font-family:'monospace'; font-size:small; color:#000000;"> s:failed = </span><span style=" font-family:'monospace'; font-size:small; color:#25bb4d;">append</span><span style=" font-family:'monospace'; font-size:small; color:#000000;"> (s:</span><span style=" font-family:'monospace'; font-size:small; color:#25bb4d;">count</span><span style=" font-family:'monospace'; font-size:small; color:#000000;">, [s:line1, s:line2])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://jenyay.net/Programming/VimScript2?action=sourceblock&amp;num=16"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; text-decoration: underline; color:#244b80; background-color:transparent;">Исходник</span></a></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">Здесь используется оператор</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">let</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;">, и необходимость в операторе </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">call</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> отпала. В дальнейшем мы могли бы проверить успешность выполнения функции </span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; font-style:italic; color:#000000;">append()</span><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000;"> и вывести при необходимости ошибку, но мы пока этого делать не будем.</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">В конце скрипта удаляем все наши переменные с помощью оператора unlet.</span></p>
<p style=" margin-top:24px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><span style=" font-family:'sans-serif,Arial,Helvetica'; font-size:16px; color:#000000; background-color:#f9f9f9;">На этом мы пока прервемся. В следующей части мы будем разбираться со списками.</span></p></body></html>