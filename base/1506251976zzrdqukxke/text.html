<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;">Java и Unicode</span><span style=" font-family:'Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;"> </span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#ffffff;"> </span><span style=" font-family:'Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#dc143c; background-color:#ffffff;">(</span><a href="mailto:sevnhuts@unis-ru.com"><span style=" font-family:'Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#dc143c; background-color:#ffffff;"> Сергей Семихатов </span></a><span style=" font-family:'Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#dc143c; background-color:#ffffff;">)<br /></span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image31164.png" /><a href="http://www.javable.com/docs/articles/unicode/index.pdf"><span style=" font-family:'Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#dd2222;">PDF версия</span></a></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:5px; margin-bottom:0px; margin-left:40px; margin-right:5px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#%3F%3F%3F%3F%3F%3F%3F%3F%3F"><span style=" font-size:medium; text-decoration: underline; color:#009999;">Аннотация</span></a></li>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:5px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#Java+%3F%3F-%3F%3F%3F%3F%3F%3F"><span style=" font-size:medium; text-decoration: underline; color:#009999;">Java по-русски</span></a></li>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:5px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#%3F%3F%3F%3F%3F%3F%3F+%3F%3F%3F%3F%3F+%3F%3F+%3F%3F%3F%3F%3F%3F%3F%3F+%3F%3F%3F%3F%3F%3F%3F%3F%3F"><span style=" font-size:medium; text-decoration: underline; color:#009999;">Русский текст из внешнего источника</span></a></li>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:5px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#Unicode+%3F+Java"><span style=" font-size:medium; text-decoration: underline; color:#009999;">Unicode и Java</span></a></li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:5px; margin-bottom:0px; margin-left:80px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#MBCS"><span style=" font-size:medium; text-decoration: underline; color:#009999;">MBCS</span></a></li>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:5px; margin-left:80px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#Unicode"><span style=" font-size:medium; text-decoration: underline; color:#009999;">Unicode</span></a></li></ul>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:5px; margin-left:40px; margin-right:5px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.javable.com/docs/articles/unicode/#%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F+%3F%3F%3F%3F%3F+%3F%3F%3F%3F%3F%3F%3F%3F+%3F+%3F%3F%3F%3F%3F%3F%3F+%3F%3F%3F%3F"><span style=" font-size:medium; text-decoration: underline; color:#009999;">Преобразование между строками и потоком байт</span></a></li></ul>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;">Аннотация</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Как известно, Java использует представление строк в формате Unicode. В этой статье речь пойдет о способах хранения и представления данных, записанных в разных кодировках.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;">Java по-русски</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Написать java-апплет, выводящий приветствие на русском языке очень просто. Можно вставить строку с русским языком прямо внутрь текста класса:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    String labelName = &quot;Привет!&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    JLabel myLabel = new JLabel(labelName);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Однако не факт, что это будет работать. Ведь тот русский текст, который был набран в редакторе, мог существовать практически в любой кодировке (DOS/Win/UNIX). Исходный текст программы обычно представлен в 8-битном формате, а один символ (char) в java занимает 2 байта (это связано с тем, что язык java ориентирован на поддержку и на работу с Unicode). Таким образом при компиляции программы происходит преобразование символов из одной кодировки (кодировки редактора) в другую (Unicode).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Это преобразование (перекодировка) основывается на том, что исходный текст программы написан в той же кодировке, что и базовая кодировка Java Virtual Machine (JVM), которая, как правило, совпадает с кодировкой самой операционной системы (для русских Windows это будет Cp1251). Таким образом, если кодировка кириллицы в редакторе совпала с кодировкой кириллицы в системе, то сообщение ``Привет!'' появится в нормальном виде.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Чтобы избежать путаницы с кодировками русского языка в тексте программы, у компилятора </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">javac</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;"> есть специальный параметр </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">encoding</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">, который определяет кодировку исходного текста программы.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Есть и другой способ. Русские буквы в тексте программы можно указывать в формате `\uXXXX' (где XXXX — шестнадцатиричный код символа в стандарте Unicode). В комплект JDK входит утилита </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">native2ascii</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">, которая позволяет перевести текст из любой поддерживаемых JDK кодировок в ASCII-вид, а символы, не имеющие отображения в ASCII, представить в `\uXXXX' виде. Узнать код того или иного символа кириллицы в Unicode можно, запустив программу </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">charmap</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;"> в WindowsNT.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;">Русский текст из внешнего источника</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Как показать русский текст из внешнего источника, например файла? Текст в файле хранится, как правило, в 8-битном формате. Для чтения/записи и преобразования набора байт в строку и обратно используются специальные классы из пакета </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">java.io</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">: InputStreamReader и OutputStreamReader.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Эти два класса специально предназначены для преобразования потока байт в указанной кодировке (чем по умолчанию является кодировка системы) в Unicode строку java.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Вот типичный пример создания ``читателя'' из файла:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    FileInputStream fis =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">       new FileInputStream(&quot;priwet.txt&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    InputStreamReader isr =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">       new InputStreamReader(fis, &quot;Cp1251&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    Reader in = new BufferedReader(isr);</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;">Unicode и Java</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Предположим, однако, что необходимо работать с внешним текстом (или данными) не только в русской, а в любой кодировке. Эту проблему можно решить двумя способами: храня внешние данные в формате Unicode или же в формате MBCS (MultiByte Character Set).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000;">MBCS</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Несмотря на то, что Unicode был специально разработан для поддержки многих языков, использовать его для хранения и передачи строк в Америке и большей части Европы неэффективно, потому что для этих регионов достаточно 256, а иногда всего 128 символов. Ведь первые 128 символов Unicode (\u0000 — \u007F) совпадают с ISO-646, а первые 256 символов (\u0000 — \u007F) совпадают с ISO-8859-1. Тем самым, используется только маленький кусочек всего спектра Unicode, ведь старший байт почти всегда равен нулю.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Возникает желание по-прежнему использовать Unicode внутри программы, но хранить и передавать данные в 8-битной кодировке, преобразуя данные непосредственно перед их получением или записью. В качестве записи в 8-битной кодировке можно использовать технологию MBCS, где каждый символ может занимать несколько байт.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Вопрос заключается в том, какой набор символов (кодировку) использовать для такого преобразования. Существующие кодировки не подходили для этой цели, поэтому Unicode Consortium выработал специальные кодировки для преобразования Unicode-строк в MBCS-строки. Эти кодировки носят название Unicode Transformation Format (UTF), и существуют в двух вариантах: UTF-7 и UTF-8. Они различаются количеством бит (7 или 8), используемых для кодирования.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Кодировка UTF-7 характерна тем, что часто требует больше байтов для представления данных, чем сам Unicode. Но эта кодировка необходима, так как многие старые системы (и не только, например, MIME) используют 7-битную кодировку символов.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Кодировка UTF-8, в свою очередь, очень хорошо подходит для хранения текста, который используют ASCII символы, и символы, чей Unicode код меньше \u0800. В этом спектре лежит большинство символов, используемых в европейских (соответственно, и американских) и ближневосточных странах. Для символов, чей код больше \u07FF, UTF-8, наоборот, мало подходит, потому что эти символы расплываются до 3 байт.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Алгоритмы конвертации между Unicode и UTF-7 или UTF-8 описаны в стандарте Unicode (The Unicode Standart).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000;">Unicode</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Чтобы узнать, как будет выглядеть текстовый файл в формате Unicode, можно запустить программу </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">notepad</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;"> в WindowsNT и при сохранении текстового файла поставить галочку ``Сохранить в формате Unicode''.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image8432.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000;">Рисунок 1.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Так как каждый символ занимает 2 байта, то возникает проблема, в каком порядке они должны быть записаны. Рассмотрим строку ``Привет!''. Возможны два варианта:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">младший байт впереди (little endian)</span></li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;"> 04 40  04 38  04 32  04 35  04 42  04 21  00</span></p>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">старший байт впереди (big endian)</span></li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;"> 40 04  38 04  32 04  35 04  42 04  21 04  00</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Какой из вариантов является правильным? В стандарте Unicode написано, что порядок байт по умолчанию является либо big endian, либо little endian :-)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Действительно, оба порядка являются правильным, и разработчики систем сами выбирают себе один из них. Так что нечего беспокоиться, если ваша Windows NT Workstation обменивается данными с Windows NT Server — они обе используют little endian.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Однако, если ваша Windows NT Workstation обменивается данными с UNIX-сервером, который использует big endian, одна из систем должна осуществлять перекодировку. В этом случае стандарт Unicode гласит, что можно выбрать любой из следующих способов решения проблемы:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Когда две системы, использующие различный порядок представления байт в Unicode, обмениваются данными (не используя каких-то специальных протоколов), то порядок байт должен быть big endian. В стандарте это называется </span><span style=" font-size:medium; font-style:italic;">каноническим порядком байт</span><span style=" font-size:medium;">. Однако второй способ является более универсальным и предпочтительным:</span></li>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Каждая строка Unicode должна начинаться с кода \uFEFF, который в стандарте называется ``знаком порядка'' (byte order mark) или ``zero-width nonbreaking space''. Код \uFFFE, который является ``перевертыванием'' знака порядка, не обозначает ничего (так он зарезервирован в стандарте Unicode). Поэтому если получатель видит в качестве первого символа код \uFEFF, то это значит, что байты находятся в перевернутом (little endian) порядке.</span></li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Вот как выглядит файл со строкой ``Привет!'', сохраненный в формате Unicode:</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image21258.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000;">Рисунок 2.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Для чтения данных, записанных как в формате MBCS (используя кодировку UTF-8), так и в формате Unicode, можно использовать все тот же класс InputStreamReader из пакета </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">java.io</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">, подставляя в его конструктор различные кодировки. В описании пакета </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:8.25pt; color:#000000;">java.lang</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;"> написано, что </span><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-style:italic; color:#000000;">каждая</span><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">  реализация JVM должна поддерживать следующие кодировки:</span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="1" cellpadding="4" bgcolor="#7099c5">
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#ffffff;">US-ASCII</span></p></td>
<td bgcolor="#f0f0ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#f0f0ff;">семибитная ASCII, она же ISO646-US, она же основная латинская часть Unicode;</span></p></td></tr>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#ffffff;">ISO-8859-1</span></p></td>
<td bgcolor="#f0f0ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#f0f0ff;">то же самое, что ISO-LATIN-1;</span></p></td></tr>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#ffffff;">UTF-8</span></p></td>
<td bgcolor="#f0f0ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#f0f0ff;">8-битный Unicode Transformation Format;</span></p></td></tr>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#ffffff;">UTF-16BE</span></p></td>
<td bgcolor="#f0f0ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#f0f0ff;">16-битный Unicode Transformation Format, порядок байт big-endian;</span></p></td></tr>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#ffffff;">UTF-16LE</span></p></td>
<td bgcolor="#f0f0ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#f0f0ff;">16-битный Unicode Transformation Format, порядок байт little-endian;</span></p></td></tr>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#ffffff;">UTF-16</span></p></td>
<td bgcolor="#f0f0ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000; background-color:#f0f0ff;">16-битный Unicode Transformation Format, порядок байт определяется начальными значениями (допускается любой), на выходе порядок байт big-endian.</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">Для чтения файла в формате Unicode надо использовать значение &quot;UTF-16&quot;, а для чтения файла в формате UTF-8 — использовать &quot;UTF-8&quot;:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    FileInputStream fis =</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">       new FileInputStream(&quot;priwet_u.txt&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    InputStreamReader isr =</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">       new InputStreamReader(fis, &quot;UTF-16&quot;);</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; font-weight:600; color:#000000; background-color:#ffffff;">Преобразование между строками и потоком байт</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;">В java для преобразования потока байт (byte[]) в строку (String) и обратно, в классе String есть следующие возможности:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Конструктор </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:medium;">String(byte[] bytes, String enc)</span><span style=" font-size:medium;"> получает на вход поток байт с указанием их кодировки; если кодировку опустить то она будет принята по умолчанию</span></li>
<li style=" font-family:'Times New Roman'; font-size:8.25pt; color:#000000;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Метод </span><span style=" font-family:'Courier New,Courier,monospace'; font-size:medium;">getBytes(String enc)</span><span style=" font-size:medium;"> возвращает поток байт, записанных в указанной кодировке; кодировку также можно опустить.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    try {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">      String priwet = new String(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">      &quot;\u041F&quot;+&quot;\u0440&quot;+&quot;\u0438&quot;+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">      &quot;\u0432&quot;+&quot;\u0435&quot;+&quot;\u0442&quot;+&quot;!&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">      byte[] utf8Bytes = priwet.getBytes(&quot;UTF8&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">      String priwet2 = new String(utf8Bytes,&quot;UTF8&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    } catch (UnsupportedEncodingException e) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">      e.printStackTrace();</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#000000;">    }</span></p></body></html>