<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:small; font-weight:600; color:#000000; background-color:#ffffff;">Удаление столбца</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="id_389"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">В</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">озможно с версии Oracle 8.</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_389"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; font-style:italic; color:#000000;">П</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; font-style:italic; color:#000000;">римеры</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_390"></a><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">A</span><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">LTER TABLE projx DROP ( pcode );</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">ALTER TABLE projx DROP COLUMN pcode;</span></pre>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_391"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">З</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">десь указаны две формы выполнения одного и того же, разве что первая форма носит более общий характер и рассчитана на возможность разом удалить группу столбцов.</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_392"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">Л</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">огическим препятствием для удаления столбца может оказаться его участие в определении внешнего ключа в качестве адресата. Не будь этого, по удалению столбца в БД осталось бы некорректно определенное правило внешнего ключа. Вместо последовательного упразднения мешающего ограничения и удаления столбца программист может обойтись одной командой, что быстрее и короче:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_393"></a><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">A</span><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">LTER TABLE projx DROP ( pcode ) CASCADE CONSTRAINTS;</span></pre>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_394"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">З</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">начения в столбцах бывшего внешнего ключа остаются, но уже не обремененные ссылочной целостностью.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_395"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; color:#000000; background-color:#ffffff;">С</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; color:#000000; background-color:#ffffff;">редства повышения эффективности удаления столбца</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="id_396"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">С</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">ледующие замечания не касаются удаления виртуальных столбцов (с версии 11), но только реальных. Удаление реального столбца влечет физическое переформатирование всех строк таблицы, что может составить технологическую проблему в случае больших объемов данных. Для нее предлагается два решения.</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_396"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">С</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">ледующее указание позволит ускорить удаление столбца за счет выполнения контрольной точки автоматически после правки каждых</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000;"> </span><span style=" font-family:'monospace'; font-size:12px; color:#8b0000;">1000</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000;"> строк (и тогда сегмент отмены не будет расти чрезмерно):</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_397"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">A</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">LTER TABLE projx DROP ( pcode ) CHECKPOINT 1000;</span></p>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_399"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">Е</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">сли в процессе удаления произошел сбой, процедуру можно продолжить командой</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_400"></a><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">A</span><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">LTER TABLE projx DROP COLUMNS CONTINUE;</span></pre>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_401"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">и</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">ли командой</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_402"></a><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">A</span><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">LTER TABLE projx DROP COLUMNS CONTINUE CHECKPOINT 1000;</span></pre>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_403"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">Д</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">ругой способ — объявить сначала столбец &quot;неиспользуемым&quot;, что</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000;"> </span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; font-style:italic; color:#000000;">не</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000;"> приведет к физическому перебору имеющихся записей:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_404"></a><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">A</span><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">LTER TABLE projx SET UNUSED COLUMN pcode CASCADE CONSTRAINTS;</span></pre>
<p style=" margin-top:7px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:16px; background-color:#ffffff;"><a name="mark_405"></a><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">Д</span><span style=" font-family:'lucida grande,tahoma,verdana,arial,sans-serif'; font-size:12px; color:#000000; background-color:#ffffff;">ля программы таблица мгновенно окажется без столбца, хотя в базе данные столбца никуда не денутся. СУБД сама их будет изымать из полей по мере обращения к строкам по текущим поводам, то есть заодно. В конечном итоге фактическое переформатирование строк таблицы может растянуться на очень долгое время. Однако при желании его можно будет целенаправленно завершить. Для этого нужно дождаться невысокой загруженности СУБД обычной работой и выдать по образцу следующего:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="mark_406"></a><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">A</span><span style=" font-family:'Courier New,courier'; font-size:12px; color:#8b0000;">LTER TABLE projx DROP UNUSED COLUMNS;</span></pre></body></html>