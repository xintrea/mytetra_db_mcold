<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f9f9f9;"><a name="ibm-leadspace-head"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">П</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">рограммирование на Python: Часть 9. Процессы и потоки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:56px; -qt-block-indent:0; text-indent:0px;"><a name="dw-summary-area"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#333333;">П</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#333333;">араллельное программирование становится в последнее время жизненной необходимостью, которая диктуется темпами развития многоядерных процессоров. Одним из вариантов организации параллельного программирования является многопоточное программирование.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:56px; -qt-block-indent:0; text-indent:0px;"><a name="nCmts"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#ffffff; background-color:#287d9f; vertical-align:top;">0</span><img src="image8575.png" /><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#333333;"> </span><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#icomments"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#00528d;">Комментарии</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:41px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#authorN10023"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#745285;">Сергей Яковлев</span></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#333333;">, Консультант, независимый специалист</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:41px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#333333;">02.09.2010</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#666666; background-color:#ffffff;" style=" margin-top:10px; margin-bottom:0px; margin-left:36px; margin-right:41px; -qt-block-indent:0; text-indent:0px;"><img src="image3725.png" /><a name="dw-toc"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:medium; font-weight:600;">С</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:medium; font-weight:600;">одержание</span></li></ul>
<p style=" margin-top:20px; margin-bottom:6px; margin-left:51px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:1.2%; background-color:#ffffff;"><img src="image7479.png" /></p>
<p style=" margin-top:9px; margin-bottom:0px; margin-left:51px; margin-right:36px; -qt-block-indent:0; text-indent:0px; line-height:16px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; color:#0e8097;">Разработайте и разверните ваше следующее приложение на облачной платформе IBM Bluemix.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:51px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="tutc-sbar-bmix-home-btn-ABa"></a><a href="https://developer.ibm.com/sso/bmregistration?lang=ru_RU&amp;ca=dwrussia-_-bluemix-_-l-python_part_9-_-sidebar"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#ffffff;">Н</span></a><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#ffffff;">ачните работу с</span><a href="https://developer.ibm.com/sso/bmregistration?lang=ru_RU&amp;ca=dwrussia-_-bluemix-_-l-python_part_9-_-sidebar"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#ffffff;"><br />бесплатной<br />пробной версией</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">С появлением многоядерных процессоров стала общеупотребительной практика распространять нагрузку на все доступные ядра. Существует два основных подхода в распределении нагрузки: использование процессов и потоков.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Использование нескольких процессов фактически означает использование нескольких программ, которые выполняются независимо друг от друга. Программно это решается с помощью системных вызовов exec и fork. Такой подход создает большие неудобства в управлении обмена данными между этими программами.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">В качестве альтернативы существует другой подход – создание многопоточных программ. Обмен данными между потоками существенно упрощается. Но управление такими программами усложняется, и вся ответственность ложится на программиста.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Сегодня мы рассмотрим следующие темы.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Как работают процессы.</span></li>
<li style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Как работают потоки в питоне.</span></li>
<li style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Создание потока.</span></li>
<li style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Очереди (Queue).</span></li>
<li style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#333333;" style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Блокировки (Lock).</span></li></ul>
<p style=" margin-top:5px; margin-bottom:5px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="N1004C"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">1</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">. Как работают процессы</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">В питоне есть стандартный модуль subprocess, который упрощает управление другими программами, передавая им опции командной строки и организуя обмен данными через каналы (pipe). Мы рассмотрим пример, в котором пользователь запускает программу из командной строки, которая в свою очередь запустит несколько дочерних программ. В данном примере два скрипта – рarent.py и child.py. Запускается parent.py. Child.py выступает в роли аргумента command, который передается в запускаемый процесс. У этого процесса есть стандартный вход, куда мы передаем два аргумента – поисковое слово и имя файла. Мы запустим два экземпляра программы child.py, каждый экземпляр будет искать слово word в своем файле – это будут файлы исходников самих программ. Запись на стандартный вход осуществляет модуль subprocess. Каждый процесс пишет результат своего поиска в консоль. В главном процессе мы ждем, пока все child не закончат свою работу.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Код parent.py:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import os</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import subprocess</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import sys</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">child = os.path.join(os.path.dirname(__file__), &quot;./child.py&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">word  = 'word'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">file = ['./parent.py','./child.py']</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">pipes = []</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">for i in range(0,2):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  command = [sys.executable, child]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  pipe = subprocess.Popen(command, stdin=subprocess.PIPE)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  pipes.append(pipe)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  pipe.stdin.write(word.encode(&quot;utf8&quot;) + b&quot;\n&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  pipe.stdin.write(file[i].encode(&quot;utf8&quot;) + b&quot;\n&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  pipe.stdin.close()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">while pipes:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    pipe = pipes.pop()</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    pipe.wait()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Код child.py:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import sys</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">word = sys.stdin.readline().rstrip()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">filename = sys.stdin.readline().rstrip()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">try:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  with open(filename, &quot;rb&quot;) as fh:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    while True:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      current = fh.readline()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      if not current:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">          break</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      if (word in current ):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">          print(&quot;find: {0} {1}&quot;.format(filename,word))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">except :</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    pass</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#cccccc;"><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#ibm-pcon"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#745285;">В начало</span></a></p>
<p style=" margin-top:5px; margin-bottom:5px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="N1005F"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">2</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">. Как работают потоки в питоне</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Если нужно, чтобы ваше приложение выполняло несколько задач в одно и то же время, то можете воспользоваться потоками (threads). Потоки позволяют приложениям выполнять в одно и то же время множество задач. Многопоточность (multi-threading) важна во множестве приложений, от примитивных серверов до современных сложных и ресурсоёмких игр.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Когда в одной программе работают несколько потоков, возникает проблема разграничения доступа потоков к общим данным. Предположим, что есть два потока, имеющих доступ к общему списку. Первый поток может делать итерацию по этому списку:</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  for x in L</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">а второй в этот момент начнет удалять значения из этого списка. Тут может произойти все что угодно: программа может упасть, или мы просто получим неверные данные.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Решением в этом случае является применение блокировки. При этом доступ к заблокированному списку будет иметь только один поток, второй будет ждать, пока блокировка не будет снята.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Применение блокировки порождает другую проблему – дедлок (deadlock) – мертвая блокировка. Пример дедлока: имеется два потока и два списка. Первый поток блокирует первый список, второй поток блокирует второй список. Первый поток изнутри первой блокировки пытается получить доступ к уже заблокированному второму списку, второй поток пытается проделать то же самое с первым списком. Получается неопределенная ситуация с бесконечным ожиданием. Эту ситуации легко описать, на практике все гораздо сложнее.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Вариантом решения проблемы дедлоков является политика определения очередности блокировок. Например, в предыдущем примере мы должны определить, что блокировка первого списка идет всегда первой, а уже потом идет блокировка второго списка.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Другая проблема с блокировками – в том, что несколько потоков могут одновременно ждать доступа к уже заблокированному ресурсу и при этом ничего не делать. Каждая питоновская программа всегда имеет главный управляющий поток.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Питоновская реализация многопоточности ограниченная. Интерпретатор питона использует внутренний глобальный блокировщик (GIL), который позволяет выполняться только одному потоку. Это сводит на нет преимущества многоядерной архитектуры процессоров. Для многопоточных приложений, которые работают в основном на дисковые операции чтения/записи, это не имеет особого значения, а для приложений, которые делят процессорное время между потоками, это является серьезным ограничением.</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#cccccc;"><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#ibm-pcon"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#745285;">В начало</span></a></p>
<p style=" margin-top:5px; margin-bottom:5px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="N10078"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">3</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">. Создание потока</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Для создания потоков мы будем использовать стандартный модуль threading. Есть два варианта создания потоков:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">вызов функции</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  threading.Thread()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">вызов класса</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  threading.Thread</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Следующий пример показывает, как к потоку приаттачить функцию через вызов функции:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import threading</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import time</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">def clock(interval):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    while True:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        print(&quot;The time is %s&quot; % time.ctime())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        time.sleep(interval)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">t = threading.Thread(target=clock, args=(15,))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">t.daemon = True</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">t.start()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Пример на создание потока через вызов класса: в конструкторе обязательно нужно вызвать конструктор базового класса. Для запуска потока нужно выполнить метод </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">start()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> объекта-потока, что приведет к выполнению действий в методе </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">run()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import threading</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import time</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">class ClockThread(threading.Thread):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    def __init__(self,interval):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        threading.Thread.__init__(self)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        self.daemon = True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        self.interval = interval</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    def run(self):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        while True:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">            print(&quot;The time is %s&quot; % time.ctime())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">            time.sleep(self.interval)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">t = ClockThread(15)</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">t.start()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Для управления потоками существуют методы:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">start()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – дает потоку жизнь.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">run()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> –этот метод представляет действия, которые должны быть выполнены в потоке.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">join([timeout])</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – поток, который вызывает этот метод, приостанавливается, ожидая завершения потока, чей метод вызван. Параметр </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">timeout</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> (число с плавающей точкой) позволяет указать время ожидания (в секундах), по истечении которого приостановленный поток продолжает свою работу независимо от завершения потока, чей метод </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">join</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> был вызван. Вызывать </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">join()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">некоторого потока можно много раз. Поток не может вызвать метод </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">join()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> самого себя. Также нельзя ожидать завершения еще не запущенного потока.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">getName()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает имя потока.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">setName(name)</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – присваивает потоку имя </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">name</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">isAlive()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает истину, если поток работает (метод </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">run()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> уже вызван).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">isDaemon()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает истину, если поток имеет признак демона.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">setDaemon(daemonic)</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – устанавливает признак </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">daemonic</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> того, что поток является демоном.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">activeCount()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает количество активных в настоящий момент экземпляров класса Thread. Фактически это </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">len(threading.enumerate())</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">currentThread()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает текущий объект-поток, т.е. соответствующий потоку управления, который вызвал эту функцию.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">enumerate()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает список активных потоков.</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#cccccc;"><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#ibm-pcon"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#745285;">В начало</span></a></p>
<p style=" margin-top:5px; margin-bottom:5px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="N100E3"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">4</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">. Очереди (Queue)</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">В следующем примере будет решена аналогичная задача, что и в предыдущем примере с процессами: будут запущены три потока, каждый из которых будет работать по принципу утилиты </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">grep</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">. Имеется глобальный ресурс – </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">work_queue</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – список файлов для поиска, который мы положим в очередь. Для этого будет использован объект </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">Queue</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">, который имеет встроенную блокировку:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import threading</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import Queue</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">class Worker(threading.Thread):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    def __init__(self, work_queue, word):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        super(Worker,self).__init__()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        self.work_queue = work_queue</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        self.word = word</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    def run(self):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        try:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">            filename = self.work_queue.get()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">            self.process(filename)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        finally:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">            pass</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    def process(self, filename):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        previous = &quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        current=True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        with open(filename, &quot;rb&quot;) as fh:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">            while current:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">                current = fh.readline()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">                if not current: break</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">                current = current.decode(&quot;utf8&quot;, &quot;ignore&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">                if self.word in current :</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">                    print(&quot;find {0}: {1}&quot;.format(self.word,filename))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">                previous = current</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">word = 'import'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">filelist = ['./file1.py','./file2.py','./file3.py']</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">work_queue = Queue.Queue()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">for filename in filelist:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    work_queue.put(filename)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">for i in range(3):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    worker = Worker(work_queue, word)</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    worker.start()</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#cccccc;"><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#ibm-pcon"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#745285;">В начало</span></a></p>
<p style=" margin-top:5px; margin-bottom:5px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="N100F7"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">5</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">. Блокировки (Lock)</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">В следующем примере будут созданы три потока, каждый из которых будет считывать стартовую страницу по указанному Web-адресу. В примере имеется глобальный ресурс – список урлов – </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">url_list</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – доступ к которому будет блокироваться с помощью блокировки </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">threading.Lock()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">. Объект </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">Lock</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> имеет методы:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">acquire([blocking=True])</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – делает запрос на запирание замка. Если параметр </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">blocking</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> не указан или является истиной, то поток будет ожидать освобождения замка.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Если параметр не был задан, метод не возвратит значения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Если </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">blocking</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> был задан и истинен, метод возвратит True (после успешного овладения замком).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Если блокировка не требуется (т.е. задан </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">blocking=False</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">), метод вернет </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">True</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">, если замок не был заперт и им успешно овладел данный поток. В противном случае будет возвращено </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">False</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">release()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – запрос на отпирание замка.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">locked()</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – возвращает текущее состояние замка (</span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">True</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – заперт, </span><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000;">False</span><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;"> – открыт).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">import threading</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">from urllib import urlopen</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">class WorkerThread(threading.Thread):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  def __init__(self,url_list,url_list_lock):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    super(WorkerThread,self).__init__()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    self.url_list=url_list</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    self.url_list_lock=url_list_lock</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  def run(self):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    while (1):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      nexturl = self.grab_next_url()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      if nexturl==None:break</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      self.retrieve_url(nexturl)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  def grab_next_url(self):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    self.url_list_lock.acquire(1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    if len(self.url_list)&lt;1:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      nexturl=None</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    else:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      nexturl = self.url_list[0]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">      del self.url_list[0]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    self.url_list_lock.release()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    return nexturl  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  def retrieve_url(self,nexturl):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    text = urlopen(nexturl).read()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    print text</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    print '################### %s #######################' % nexturl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">url_list=['http://linux.org.ru','http://kernel.org','http://python.org']</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">url_list_lock = threading.Lock()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">workerthreadlist=[]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">for x in range(0,3):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  newthread = WorkerThread(url_list,url_list_lock)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  workerthreadlist.append(newthread)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  newthread.start()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">for x in range(0,3):</span></p>
<p style=" margin-top:0px; margin-bottom:6px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Andale Mono,Lucida Console,Monaco,Liberation,fixed,monospace'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">  workerthreadlist[x].join()</span></p>
<p style=" margin-top:10px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px; background-color:#cccccc;"><a href="https://www.ibm.com/developerworks/ru/library/l-python_part_9/#ibm-pcon"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; font-weight:600; text-decoration: underline; color:#745285;">В начало</span></a></p>
<p style=" margin-top:5px; margin-bottom:5px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><a name="N10132"></a><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">З</span><span style=" font-family:'HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial'; font-size:8.25pt; font-weight:600; color:#000000;">аключение</span></p>
<p style=" margin-top:5px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Параллельное программирование становится в последнее время жизненной необходимостью, которая диктуется темпами развития многоядерных процессоров. Одним из вариантов организации параллельного программирования является многопоточное программирование. В обычной программе действует всего один поток управления, а в многопоточной одновременно могут работать несколько потоков.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">В многопоточной программе усложняется контроль за обменом данных между потоками. Глобальные ресурсы необходимо предохранять от одновременного доступа со стороны нескольких потоков, чтобы не нарушить их целостности. В этой статье были рассмотрены инструменты контроля глобальных данных – блокировки, очереди.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:36px; margin-right:36px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial,sans-serif'; font-size:8.25pt; color:#222222;">Приведенные примеры проверялись на версии питона 2.6.</span></p></body></html>