<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:xx-large; color:#000000; background-color:#ffffff;">Работа с деревьями в Oracle</span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="art_content"></a><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:11px; color:#000000;">И</span><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:11px; color:#000000;">сточник:</span><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:11px; color:#000000;"> </span><a href="http://www.interface.ru/iservices/goto.asp?Url=enc:rn%7Ej%40%255m%7Dm4%5Bvf7ex%5Bifo%24xo5Yud%7E%5Ftn5ls%5F%7D%25Ejkh%7E7%3B%1Cs%5EG%2C9"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:11px; color:#003399;">all-oracle</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; font-weight:600; color:#000000;">Рекомендовано для:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;" style=" margin-top:4px; margin-bottom:0px; margin-left:-10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12px;">Oracle Database 8i</span></li>
<li style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:-10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12px;">Oracle Database 9i R1</span></li>
<li style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:-10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12px;">Oracle Database 9i R2</span></li>
<li style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:-10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12px;">Oracle Database 10g R1</span></li>
<li style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:-10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12px;">Oracle Database 10g R2</span></li>
<li style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;" style=" margin-top:0px; margin-bottom:4px; margin-left:-10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12px;">Oracle Database 11g R1</span></li></ul></td>
<td>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"> </span></p></td></tr>
<tr>
<td colspan="2">
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Эта статья посвящена работе с деревьями в </span><a href="http://www.interface.ru/home.asp?artId=64&amp;vId=17"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; font-weight:600; color:#003399;">Oracle</span></a><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">. В большинстве современных СУБД нет встроенных средств для работы с иерархическими структурами, для построения дерева на основе таблицы приходится писать громоздкие процедуры, или разносить данные по нескольким таблицам.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Oracle предлагает достаточно средств, для удовлетворения практически любых желаний при работе с иерархиями. В это статье я попытаюсь на примерах показать, как это применять, и какие результаты достигаются.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Классическим примером дерева является иерархия сотрудников на предприятии. Для демонстрации работы с деревьями создадим таблицу и заполним ее данными:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CREATE TABLE EMPL (<br />       ID         INTEGER PRIMARY KEY,<br />       NAME    VARCHAR(50),<br />       PARENT_ID  REFERENCES EMPL<br />);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Добавим данные в таблицу:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (1, 'Директор', NULL);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (2, 'Заместитель по экономике', 1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (3, 'Заместитель по ИТ', 1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (4, 'Программист', 3);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (5, 'Программист-стажер', 4);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (6, 'Главный бухгалтер', 1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (7, 'Бухгалтер 1', 6);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">INSERT INTO EMPL VALUES (8, 'Бухгалтер 2', 6);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Проверяем:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SQL&gt; SELECT * FROM EMPL;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">        ID NAME                                                PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">---------- -------------------------------------------------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         1 Директор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         2 Заместитель по экономике                                    1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         3 Заместитель по ИТ                                           1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         4 Программист                                                 3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         5 Программист-стажер                                          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         6 Главный бухгалтер                                           1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         7 Бухгалтер 1                                                 6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">         8 Бухгалтер 2                                                 6</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Значения столбца PARENT_ID, реально указывают на другие строки в таблице EMPL. Для отображения получившийся иерархии имея в распоряжении стандартный SQL и любой язык программирования, такой как C++, Delphi или C# придется написать достаточно громоздкий код. Отобрать сначала узлы верхнего уровня, далее в зависимости от выбранного узла запрашивать подчиненные записи и т.д.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">В распоряжение пользователя, Oracle предоставляет предложение языка PL/SQL - CONNECT BY. Оно позволяет строить иерархию одним запросом, просто и изящно:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT NAME, ID, PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">NAME                                                       ID  PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">-------------------------------------------------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по экономике                                    2          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по ИТ                                           3          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист                                                 4          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер                                          5          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Главный бухгалтер                                           6          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 1                                                 7          6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 2                                                 8          6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист                                                 4          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер                                          5          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер                                          5          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 1                                                 7          6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 2                                                 8          6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                                    1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по экономике                                    2          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по ИТ                                           3          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист                                                 4          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер                                          5          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Главный бухгалтер                                           6          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 1                                                 7          6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 2                                                 8          6</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">20 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Полученный результат кажется не совсем понятным, но если внимательно посмотреть, то видно, что выстроены все возможные деревья и поддеревья. Теперь добавим в запрос конструкцию START WITH:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT NAME, ID, PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID IN (SELECT ID </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">                  FROM EMPL </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">                  WHERE PARENT_ID IS NULL);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">NAME                                                       ID  PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">-------------------------------------------------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                                    1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по экономике                                    2          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по ИТ                                           3          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист                                                 4          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер                                          5          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Главный бухгалтер                                           6          1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 1                                                 7          6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 2                                                 8          6</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Обратите внимание, что в предложении START WITH использован вложенный запрос для определения кто стоит на самом верху. Обычно, в поле PARENT_ID для узлов, используют NULL или -1. Естественно, что их может быть один и более. Сама конструкция START WIDTH указывает, откуда начинать строить дерево.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Теперь, наведем немного порядок, упорядочим записи, и покажем кто находится на каком уровне иерархии. Для этого, Oracle предоставляет псевдоколонку LEVEL. Она может быть использована только в том случае, если в запросе присутствует CONNECT BY. Для упрощения укажем ID =1:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT NAME, ID, PARENT_ID, LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">NAME                                             ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">---------------------------------------- ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                          1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по экономике                          2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Заместитель по ИТ                                 3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист                                       4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер                                5          4          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Главный бухгалтер                                 6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 1                                       7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Бухгалтер 2                                       8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Колонка LEVEL может быть использована для отметки записи. Используем оператор конкатенации (//)для добавления пробелов в начале каждой строки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                      ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">----------------------------------- ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                     1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике                   2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                          3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                              4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">      Программист-стажер                     5          4          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                          6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                              7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                              8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Для ограничения вывода можно использовать стандартное условие WHERE. Уберем из вывода сотрудников, у которых уровень меньше, либо равен 3:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">WHERE LEVEL &lt;=3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                      ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">----------------------------------- ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                     1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике                   2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                          3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                              4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                          6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                              7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                              8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">7 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Если вы хотите произвести сортировку, то стоит учитывать, ORDER BY работает не совсем так, как в случае с простыми данными, без иерархии. Продемонстрируем это:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER BY LEVEL, NAME;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                      ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">----------------------------------- ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                     1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                          6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                          3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике                   2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                              7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                              8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                              4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">      Программист-стажер                     5          4          4</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Как видно, сортировка прошла по колонке LEVEL, и затем уже по имени, но замете, что самое важное, иерархия сохранена, и внутри каждого уровня иерархии уже идет сортировка по имени. А что же будет, если из условия сортировки убрать поле LEVEL?</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER BY NAME;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                      ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">----------------------------------- ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                              7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                              8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                          6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                     1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                          3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике                   2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                              4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">      Программист-стажер                     5          4          4</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Как видно вся иерархия поломалась. Чтобы указать Oracle, что сортировать надо только в пределах одного уровня иерархии, поможет маленькая добавка в виде оператора SIBLINGS. Достаточно изменить условие сортировки на ORDER SIBLINGS BY &lt;поле&gt; - и все встанет на свои места.</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER SIBLINGS BY NAME;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                      ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">----------------------------------- ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                     1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                          6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                              7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                              8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                          3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                              4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">      Программист-стажер                     5          4          4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике                   2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Еще одна очень полезная функция - SYS_CONNECT_BY_PATH().Она принимает два параметра через запятую: название колонки и строку с символом-разделителем. Для иллюстрации ее работы выполним такой запрос:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT SYS_CONNECT_BY_PATH(NAME, '/') AS PATH</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">WHERE ID=5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH PARENT_ID IS NULL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">PATH</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">-------------------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">/Директор/Заместитель по ИТ/Программист/Программист-стажер</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">В результате получаем путь от большого босса до стажера. Сейчас это выглядит как путь в файловом менеджере, но эта функция может быть вам очень полезна, к тому же разделитель можно сменить.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Топаем дальше. Псевдоколонка CONNECT_BY_ISLEAF. Ее можно использовать так же, как LEVEL. В этой колонке напротив каждой строки проставляется 0 или 1. Если есть потомки - то 0. Если потомков нет, такой узел в дереве называется &quot;листом&quot;, тогда и значение в поле CONNECT_BY_ISLEAF будет равно 1.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Помните такую конструкцию PRIOR, которая позволяла ссылаться на родительскую запись? Так вот, есть такой оператор, CONNECT_BY_ROOT, который ссылается на корень дерева. Для демонстрации работы выполним:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT ID, NAME, PARENT_ID, LEVEL, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    CONNECT_BY_ISLEAF AS ISLEAF, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    PRIOR NAME AS PARENT, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    CONNECT_BY_ROOT NAME AS ROOT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH PARENT_ID IS NULL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER SIBLINGS BY NAME;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Если при построении дерева вы получаете ошибку, о том, что найдена петля (цикл), то это означает - дерево неверно спроектировано. На такой случай, есть NOCYCLE. Это позволит вам избежать бесконечных циклов. Для иллюстрации работы, выполним:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">UPDATE EMPL SET PARENT_ID=5 WHERE ID=5;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">COMMIT;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Теперь, программист-стажер подчиняется сам себе. Выполняем:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER BY LEVEL, NAME;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                 ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">------------------------------ ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор                                1                     1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                     6          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                     3          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике              2          1          2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                         7          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                         8          6          3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                         4          3          3</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">7 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">И видим, что стажера нет, он выпал из дерева. Oracle не видит пути, и не включает элемент в иерархию. Попробуем заставить его начать со стажера. Для этого немного поменяем условия запроса:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER BY LEVEL, NAME;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">     *</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">error at line 6:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORA-01436: CONNECT BY loop in user data</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Что бы избежать таких неприятных ситуаций, изменим запрос, что бы он выглядел так:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY NOCYCLE PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ORDER BY LEVEL, NAME;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                                 ID  PARENT_ID      LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">------------------------------ ---------- ---------- ----------</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Программист-стажер</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:medium; font-weight:600; color:#000000;">JOIN не работает с CONNECT BY</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Например, построим отчет в котором укажем сотрудника и его непосредственного начальника:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // A.NAME AS Н_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  B.NAME AS BOSS_NAME </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL A, EMPL B</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">WHERE A.PARENT_ID = B.ID(+)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR A.ID = A.PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH A.ID = 1;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">На старых версиях Oracle, можно получить сообщение об ошибке:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">ERROR at line 4:<br />ORA-01437: cannot have join with CONNECT BY</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Обойти эту проблему можно создав представление:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CREATE OR REPLACE VIEW V_EMPL </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">AS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  PARENT_ID, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LEVEL AS THE_LEVEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Колонку LEVEL переименовали, чтобы представление не заканчивалось на зарезервированное слово.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SQL&gt; SELECT * FROM V_EMPL;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Сейчас можно выполнить JOIN</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">   A.H_NAME,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">   B.NAME AS BOSS_NAME</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM V_EMPL A, EMPL B</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">WHERE A.PARENT_ID = A.ID(+);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Если обратите внимание, то увидите что выполнено OUTER JOIN, потому что в списке нет большого босса.</span></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:small; font-weight:600; color:#000000;">Подзапросы, списки и CONNECT BY</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Вместо VIEW и JOIN можно использовать вложенные запросы в списке выборки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">SELECT </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  LPAD(' ', (LEVEL - 1) * 2) // NAME AS H_NAME, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  (SELECT NAME </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">   FROM EMPL B</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">   WHERE B. ID = A.PARENT_ID) AS BOSS_NAME</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">FROM EMPL A</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CONNECT BY PRIOR ID = PARENT_ID</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">START WITH ID = 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">H_NAME                              BOSS_NAME</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">----------------------------------- -----------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Директор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по экономике          Директор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Заместитель по ИТ                 Директор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Программист                     Заместитель по ИТ</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">      Программист-стажер            Программист</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">  Главный бухгалтер                 Директор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 1                     Главный бухгалтер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">    Бухгалтер 2                     Главный бухгалтер</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">8 rows selected.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:medium; font-weight:600; color:#000000;">Производительность</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">Для увеличения производительности, вам потребуется создать индексы на таблицу, которые позволят Oracle быстрее получать ответ на вопрос, &quot;кто является детьми некого родителя Х?&quot;:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CREATE INDEX EMPL_IDX1 ON EMPL (ID, PARENT_ID);</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,MS Sans Serif,sans-serif,Arial'; font-size:12px; color:#000000;">CREATE INDEX EMPL_IDX2 ON EMPL (PARENT_ID, ID);</span></p></td></tr></table></body></html>