<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Keys and constraints are used as a way to ensure that our data meets certain require‐ ments prior to being stored in the database. The objects that represent keys and con‐ straints can be found inside the base SQLAlchemy module, and three of the more common ones can be imported as shown here: </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000080;">from </span><span style=" font-family:'Courier New'; color:#000000;">sqlalchemy </span><span style=" font-family:'Courier New'; font-weight:600; color:#000080;">import </span><span style=" font-family:'Courier New'; color:#000000;">PrimaryKeyConstraint, UniqueConstraint, CheckConstraint</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The most common key type is a primary key, which is used as the unique identifier for each record in a database table and is used used to ensure a proper relationship between two pieces of related data in different tables. As you saw earlier in Example 1-1 and Example 1-2, a column can be made a primary key simply by using the primary_key keyword argument. You can also define composite primary keys by assigning the setting primary_key to True on multiple columns. The key will then essentially be treated like a tuple in which the columns marked as a key will be present in the order they were defined in the table. Primary keys can also be defined after the columns in the table constructor, as shown in the following snippet. You can add multiple columns separated by commas to create a composite key. If we wanted to explicitly define the key as shown in Example 1-2, it would look like this:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000; background-color:#e4e4ff;">PrimaryKeyConstraint</span><span style=" font-family:'Courier New'; color:#000000;">(</span><span style=" font-family:'Courier New'; font-weight:600; color:#008080;">'user_id'</span><span style=" font-family:'Courier New'; color:#000000;">, </span><span style=" font-family:'Courier New'; color:#660099;">name</span><span style=" font-family:'Courier New'; color:#000000;">=</span><span style=" font-family:'Courier New'; font-weight:600; color:#008080;">'user_pk'</span><span style=" font-family:'Courier New'; color:#000000;">)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Another common constraint is the unique constraint, which is used to ensure that no two values are duplicated in a given field. For our online cookie delivery service, for example, we would want to ensure that each customer had a unique username to log into our systems. We can also assign unique constraints on columns, as shown before in the username column, or we can define them manually as shown here:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000; background-color:#ffffff;">UniqueConstraint(</span><span style=" font-family:'Courier New'; font-weight:600; color:#008080;">'username'</span><span style=" font-family:'Courier New'; color:#000000;">, </span><span style=" font-family:'Courier New'; color:#660099;">name</span><span style=" font-family:'Courier New'; color:#000000;">=</span><span style=" font-family:'Courier New'; font-weight:600; color:#008080;">'uix_username'</span><span style=" font-family:'Courier New'; color:#000000;">)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Not shown in Example 1-2 is the check constraint type. This type of constraint is used to ensure that the data supplied for a column matches a set of user-defined criteria. In the following example, we are ensuring that unit_cost is never allowed to be less than 0.00 because every cookie costs something to make (remember from Economics 101: TINSTAAFC—that is, there is no such thing as a free cookie!):</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000; background-color:#e4e4ff;">CheckConstraint</span><span style=" font-family:'Courier New'; color:#000000;">(</span><span style=" font-family:'Courier New'; font-weight:600; color:#008080;">'unit_cost &gt;= 0.00'</span><span style=" font-family:'Courier New'; color:#000000;">, </span><span style=" font-family:'Courier New'; color:#660099;">name</span><span style=" font-family:'Courier New'; color:#000000;">=</span><span style=" font-family:'Courier New'; font-weight:600; color:#008080;">'unit_cost_positive'</span><span style=" font-family:'Courier New'; color:#000000;">)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">In addition to keys and constraints, we might also want to make lookups on certain fields more efficient. This is where indexes come in.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>