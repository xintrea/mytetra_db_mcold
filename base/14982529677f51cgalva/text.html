<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:5px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:34px; background-color:#ffffff;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:xx-large; font-weight:496; color:#444444;">6 способов слияния списка списков</span></p>
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/hub/python/"><span style=" font-family:'Verdana,sans-serif'; font-size:11px; color:#999999; background-color:transparent; vertical-align:middle;">Python</span></a><span style=" font-family:'Verdana,sans-serif'; font-size:11px; color:#999999;">*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px; line-height:22.4px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">Зашел тут у нас в офисе разговор как наиболее «красиво» и быстро склеить список списков в Питоне. Действительно как?<br /><br />Даже такую казалось бы тривиальную задачу можно решить несколькими способами, существенно отличающимися по скорости и выразительности.<br /><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ВАРИАНТ1</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Все знают, что элементы списка можно перебирать в цикле и, то что можно добавлять элементы в конец. Это приводит нас к первому варианту решения:<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">def</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> listmerge1(lstlst):<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">=[]<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lst </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lstlst:<br />        </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> el </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lst:<br />            </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">.append(el)<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">return</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Мало того, что функция растянулось аж на 6 строк, так вдобавок она еще и не эффективная.<br />Попробуем её улучшить в обоих смыслах: скорости и красоты («pythonic way»).<br /></span><a name="habracut"></a><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ВАРИАНТ2</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Тут мы вспоминаем, что в Питоне есть оператор &quot;+&quot; для строк и получаем:<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">def</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> listmerge2(lstlst):<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">=[]<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lst </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lstlst:<br />      </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">+lst<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">return</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Это самая медленная реализация. Прокол в том что в таком виде оператор &quot;+&quot; в каждом шаге создает новый объект-список, который на следующем шаге выкидывается и т.д.<br /><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ВАРИАНТ3</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Исправить легко, надо заменить &quot;+&quot; на форму которая не создает новый список, а добавляет к старому. Это оператор &quot;+=&quot;, но я предпочитаю писать в явном виде метод «extend».<br /><br />Так мы получили самый быстрый вариант, но не самый короткий.<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">def</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> listmerge3(lstlst):<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">=[]<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lst </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lstlst:<br />      </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">.extend(lst)<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">return</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">all</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Все последующие решения я буду писать через лямбда-выражения, тк они состоят из одного выражения. Имя аргумента сокращено до ll, тк в коде в одну строку это не уменьшает читабельности.<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#808080;"># через анонимную функцию</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /> listmerge=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> ll : simple-statement<br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#808080;"># эквивалентно</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">def</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> listmerge(ll):<br />  </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">return</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> simple-statement</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ВАРИАНТ4</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Используя встроенные функции работы со списками, можно переписать вариант2 в стиле функционального программирования:<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">listmerge4a=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> ll: </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">reduce</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">(</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> a,b: a+b, ll, [])<br />listmerge4b=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> ll: </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">sum</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">(ll, [])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Он чуть чуть быстрее, но все еще тормозной по той же причине, что и его итеративный родственник. Здесь «lambda a,b: a+b» — анонимная функция двух аргументов, которая просто возвращает их сумму. Вариант B это просто шорткат, встроенный в Питон для удобста вычисления суммы элементов. Этот вариант самый короткий.<br /><br />Лично меня не устраивает ни самый короткий (скорость), ни самый быстрый (красота). Попробуем найти компромисс.<br /><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ВАРИАНТ5</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />С помощью списковых выражений:<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">listmerge5=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> ll: [el </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lst </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> ll </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> el </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> lst]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Не сильно длиннее предыдущего, но радикально быстрее. Вариант несомненно красив, хотя вложенные списковые выражения не всегда понятны с первого взгляда.<br /><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ВАРИАНТ6</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />А что если попробовать переписать самый быстрый вариант в функцональном стиле? Легко:<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">listmerge6=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> s: </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#008000;">reduce</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">(</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">lambda</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> d,el: d.extend(el) </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">or</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> d, s, [])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Заметьте &quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">d.extend(el) or d</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">&quot; нам пришлось добавить оператор &quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">or</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">&quot; тк метод </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">extend</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> возвращает </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">None</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">. По скорости он практически не уступает самому быстрому методу №3 (разница в скорости буквально единицы процентов и на мой взгляд не существенна).<br /><br />По моему мнению &quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">выбор редакции</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">&quot; стоит присудить варианту </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">№6</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">)<br /><br />Для замеров скорости маленьких кусков кода в Питоне есть библиотека </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">timeit</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">. Вот пример кода, тестирующего варианты 3, 5 и 6 (самые быстрые и красивые).<br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">import</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#dc143c;">timeit</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /> <br />variants = {<br /> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">'Reduce'</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> :<br /> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">'listmerge=lambda s: reduce(lambda d,el: d.extend(el) or d, s, [])'</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,<br /> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">'Iterate'</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> :<br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;&quot;&quot;<br />def listmerge(lstlst):<br />  all=[]<br />  for lst in lstlst:<br />    all.extend(lst)<br />  return all<br />&quot;&quot;&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,<br />  </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">'Comprehension'</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> :<br />  </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">'listmerge=lambda ll: [x for lst in ll for x in lst]'</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,<br />}<br /> <br />initstr=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">'lstlst=[range(i) for i in range(1000)]</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000099;">\n</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">gc.enable()'</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /> <br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">def</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#dc143c;">test</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">(variants, initstr,n=</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">100</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">):<br />  </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">print</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;Test repeats n =&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,n,</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot; times</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000099;">\n</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">INITSTR:&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,initstr,</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000099;">\n\n</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />  </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">for</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> k,v </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">in</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> variants.iteritems():<br />    </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">print</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"> k, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot; - &quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#dc143c;">timeit</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">.Timer(</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;listmerge(lstlst)&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, initstr+</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000099;">\n</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#483d8b;">&quot;</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">+v).</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#dc143c;">timeit</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">(n)<br />  </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff7700;">print</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /> <br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#dc143c;">test</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">(variants,initstr,</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">100</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Пример запуска теста времени. Видно что разница скорости между итеративным и функциональным вариантом исчезающе мала. Вариант на списковых выражениях заметно медленней (тут на погрешности не спишешь), но и размер наших списков огромен, для некритичных к скорости приложений он тоже имеет право на жизнь. <br /></span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:14px; color:#222222;">Test repeats n = 100 times<br />INITSTR: lstlst=[range(i) for i in range(1000)]<br />gc.enable()<br /><br />Iterate - 1.56133103371<br />Reduce - 1.57647109032<br />Comprehension - 7.5749669075<br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br /><br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; font-weight:696; color:#000000;">ДОМАШНЕЕ ЗАДАНИЕ</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />Предлагаю решить/обсудить более сложную задачу развертывание вложенных списков в линейный.<br />Пример: <br /></span></p>
<p style=" margin-top:11px; margin-bottom:11px; margin-left:-5px; margin-right:-5px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#808080;"># Исходный список:</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />[</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">7</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,[[[[</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">2</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">]]],[[[]],[</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">4</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">]],[</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">4</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">5</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,[</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">6</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">,</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">7</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">]]],</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">8</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">]<br /></span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#808080;"># Результат:</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;"><br />[</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">7</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">2</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">4</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">4</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">5</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">6</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">7</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">, </span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#ff4500;">8</span><span style=" font-family:'Verdana,sans-serif'; font-size:14px; color:#000000;">]</span></p></body></html>