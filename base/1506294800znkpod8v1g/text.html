<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/flows/develop/"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:496; text-decoration: underline; color:#548eaa; background-color:transparent;">Разработка</span></a></p>
<p style=" margin-top:0px; margin-bottom:11px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Fira Sans,sans-serif'; font-size:8.25pt; font-weight:496; color:#343434;">LogParser — привычный взгляд на непривычные вещи</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#5e6973;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:8px; -qt-block-indent:0; text-indent:0px;"><a href="https://habrahabr.ru/hub/sql/"><span style=" font-size:13px; text-decoration: underline; color:#0000ff; background-color:transparent;">SQL</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.56%; background-color:#ffffff;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;">Когда я в очередной раз использовал LogParser, то чтобы проникнуться и чужим опытом, ввел его название в поиск на Хабре. Как результат — сообщение «Удивительно, но поиск не дал результатов». Вот уж воистину удивительно, когда столь интересный инструмент обойден вниманием. Пришла пора восполнить этот пробел. Итак, встречайте </span><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&amp;DisplayLang=en"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#487284; background-color:transparent;">LogParser</span></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;">. Маленькая, но чертовски полезная утилита для любителей SQL.<br /><br />Из названия инструмента, казалось бы, очень непросто понять, что он делает в разделе SQL. А правда заключается в том, что он такой же LogParser, как и ChartGenerator. В то смысле, что он справляется с обоими задачами с одинаковыми успехом. В целом я бы его охарактеризовал как SQL-процессор гетерогенных данных. Концепция работы в общем такова, что он берет данные из некоторого формата и преобразует их в табличный вид (собственно говоря, только на этом этапе и выполняется иногда парсинг). Затем, посредством выполнения над этими табличными данными некоторого SQL-запроса формирует таблицу с результатом и сохраняет ее опять же в некотором формате. Если коротко, то цепочка выглядит как подготовка входных данных-&gt;SQL-процессинг-&gt;генерация выходных данных.</span><a name="habracut"></a><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;">И</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;">ли, как это проиллюстрировано в документации:<br /></span><img src="image17701.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br />Пора, пожалуй переходить от теории к практике, ибо она гораздо более наглядна. Начнем для затравки с такого примера:<br /><br /></span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:8.25pt; color:#222222;">X:\&gt;LogParser.exe -i:FS -o:CSV &quot;SELECT TOP 100 HASHMD5_FILE(Path) AS Hash, COUNT(*) AS FileCount, AVG(Size) AS FileSize INTO Duplicates.csv FROM X:\Folder\*.* GROUP BY Hash HAVING FileCount &gt; 1 AND FileSize &gt; 0 ORDER BY FileSize DESC&quot;<br /><br />Statistics:<br />-----------<br />Elements processed: 10<br />Elements output: 2<br />Execution time: 0.06 seconds</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /><br />Я думаю многие сразу догадалось, что за таинство здесь произошло. В привычном и знакомом SQL-стиле мы осуществляем выборку… файлов из папки X:\Folder, группируем эти файлы по MD5, чтобы выявить среди них дубликаты по содержанию. Естественно, отбрасываем те случаи, когда количество таких файлов = 1 (т.е. одинаковых нет). В дополнение мы упорядочиваем найденные дубли в порядке убывания размера и выводим только top100 самых великовесных. Чтобы убедиться в правильности результата — загляните в файл Duplicates.csv. Там вы найдете что-то в следующем духе:<br /><br /></span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:8.25pt; color:#222222;">Hash,FileCount,FileSize<br />7EF9FDF4B8BDD5B0BBFFFA14B3DAD42D,2,5321<br />5113280B17161B4E2BEC7388E617CE91,2,854</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /><br />Первым значением будет MD5-хэш найденных дублей, вторым — их количество и третьим — размер. Попробуем теперь разложить код примера в соответствии с ранее описываемой концепцией. Входные данные определяются провайдером входного формата и некоторым адресом согласно выбранному провайдеру. В нашем случае он задается опцией -i:FS для файловой системы. А адресуются конкретные данные (папка X:\Folder) в части FROM нашего SQL-запроса. Запрос к реестру, например, для ветки \HKLM\Software выглядел бы так: LogParser.exe -i:REG «SELECT * FROM \HKLM\Software». Провайдер — REG, адрес — \HKLM\Software.<br /><br />По умолчанию LogParser предлагает нам следующие провайдеры исходных форматов:<br /><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#222222;">IIS Log File Input Formats</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">IISW3C: parses IIS log files in the W3C Extended Log File Format.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">IIS: parses IIS log files in the Microsoft IIS Log File Format.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">BIN: parses IIS log files in the Centralized Binary Log File Format.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">IISODBC: returns database records from the tables logged to by IIS when configured to log in the ODBC Log Format.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">HTTPERR: parses HTTP error log files generated by Http.sys.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">URLSCAN: parses log files generated by the URLScan IIS filter.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#222222;">Generic Text File Input Formats</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">CSV: parses comma-separated values text files.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">TSV: parses tab-separated and space-separated values text files.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">XML: parses XML text files.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">W3C: parses text files in the W3C Extended Log File Format.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">NCSA: parses web server log files in the NCSA Common, Combined, and Extended Log File Formats.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">TEXTLINE: returns lines from generic text files.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">TEXTWORD: returns words from generic text files.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#222222;">System Information Input Formats</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">EVT: returns events from the Windows Event Log and from Event Log backup files (.evt files).</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">FS: returns information on files and directories.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">REG: returns information on registry values.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">ADS: returns information on Active Directory objects.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#222222;">Special-purpose Input Formats</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">NETMON: parses network capture files created by NetMon.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">ETW: parses Enterprise Tracing for Windows trace log files and live sessions.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">COM: provides an interface to Custom Input Format COM Plugins.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br />Уже немало. А учитывая, что можно создавать свои собственные провайдеры — вообще замечательно. Позже я затрону этот вопрос и покажу как можно их создавать как «по-взрослому», используя скомпилированные сборки, так и «на-лету», просто с помощью скриптов.<br /><br />Формат артефакта на выходе определяется похожим образом. Опцией -o:CSV мы указали, что нас интересует провайдер для CSV-файлов, а в части INTO нашего SQL-запроса адресовали искомый файл, куда будет сохранен результат. По аналогии с входными провайдерами перечислим и выходные, доступные «из коробки».<br /><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#222222;">Generic Text File Output Formats</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">NAT: formats output records as readable tabulated columns.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">CSV: formats output records as comma-separated values text.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">TSV: formats output records as tab-separated or space-separated values text.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">XML: formats output records as XML documents.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">W3C: formats output records in the W3C Extended Log File Format.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">TPL: formats output records following user-defined templates.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">IIS: formats output records in the Microsoft IIS Log File Format.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; font-weight:600; color:#222222;">Special-purpose Output Formats</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /></span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">SQL: uploads output records to a table in a SQL database.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">SYSLOG: sends output records to a Syslog server.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">DATAGRID: displays output records in a graphical user interface.</span></li>
<li style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.6%;"><span style=" font-size:16px;">CHART: creates image files containing charts.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /><br />Давайте попробуем еще один пример для затравки с совершенно другими входными и выходными провайдерами. Например, часто встречаемая задача по анализу логов веб-сервера и выводу топа ссылающихся сайтов.<br /><br /></span><span style=" font-family:'Menlo,Monaco,Courier New,monospace'; font-size:8.25pt; color:#222222;">c:\Program Files\Log Parser 2.2&gt;LogParser.exe -i:W3C -o:CHART &quot;SELECT TOP 10 DISTINCT EXTRACT_TOKEN(EXTRACT_TOKEN(cs(Referer), 1, '://'), 0, '/') AS Domain, COUNT(*) AS Hits INTO Hits.gif FROM X:\ex0909.log WHERE cs(Referer) IS NOT NULL AND Domain NOT LIKE '%disele%' GROUP BY Domain ORDER BY Hits DESC&quot; -chartType:Column3D -chartTitle:&quot;Top 10 referrers&quot; -groupSize:800x600<br /><br />Statistics:<br />-----------<br />Elements processed: 1410477<br />Elements output: 10<br />Execution time: 16.92 seconds</span><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /><br />Как видите, LogParser перемолотил почти полтора миллиона записей менее чем за 17 секунд с нетривиальными условиями на древнем Pentium D 2.8, что, на мой взгляд, далеко не такой плохой результат. Ну а главный результат — на картинке:<br /><br /></span><img src="image5220.png" /><span style=" font-family:'-apple-system,BlinkMacSystemFont,Arial,sans-serif'; font-size:8.25pt; color:#222222;"><br /><br />Мне кажется — это потрясающий инструмент для базаданщиков :), ибо позволяет применить магию SQL там, где нам зачастую хотелось, но было невозможно. За сим тезисом я пока приостановлю своё повествование. Во-первых, говорить о LogParser можно еще очент долго и в рамки одного поста он не поместится. Во-вторых, хочется надеятся, что настоящего материала достаточно, чтобы хоть чуть-чуть заинтересовать коллег по цеху и понять, насколько они разделяют мой восторг от этой утилиты. А как только будут заинтересованные в продолжении, я незамедлительно это сделаю, благо нераскрытых тем осталось очень много. Это и режим конвертирования. И формирование выходных данных напрямую, а также с помощью LogParser-шаблонов и XSLT. Инкрементный режим для работы с большими объемами данных. Создание собственных входных форматов на примере C# и JavaScript. Использование LogParser из приложений. Мультввод и мультивывод в несколько файлов. Знакомство с обилием тонкостями SQL LogParser'а, включая громадье его функций. Различные опции и настройки командной строки. Тонкости тех или иных провайдеров и их настройка. Ну и конечно, больше примеров всяких и разных :)</span></p></body></html>