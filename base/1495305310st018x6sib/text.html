<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#2b2b2b;"><span style=" font-family:'Courier New'; color:#808080;">### 1. Декораторы / decorators как обертки<br /><br /><br /></span><span style=" font-family:'Courier New'; color:#a9b7c6;">```python<br /><br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">my_shiny_new_decorator</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(function_to_decorate):<br />    </span><span style=" font-family:'Courier New'; color:#808080;">#### Внутри себя декоратор определяет функцию-&quot;обёртку&quot;. Она будет обёрнута вокруг декорируемой,<br />    #### получая возможность исполнять произвольный код до и после неё.<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">the_wrapper_around_the_original_function</span><span style=" font-family:'Courier New'; color:#a9b7c6;">():<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;Я - код, который отработает до вызова функции&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        function_to_decorate()  </span><span style=" font-family:'Courier New'; color:#808080;">#### Сама функция<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;А я - код, срабатывающий после&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; color:#808080;">#### Вернём эту функцию<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">the_wrapper_around_the_original_function<br /><br /><br /></span><span style=" font-family:'Courier New'; color:#808080;">#### Представим теперь, что у нас есть функция, которую мы не планируем больше трогать.<br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">stand_alone_function</span><span style=" font-family:'Courier New'; color:#a9b7c6;">():<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;Я простая одинокая функция, ты ведь не посмеешь меня изменять?&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br /><br />stand_alone_function()<br /></span><span style=" font-family:'Courier New'; color:#808080;">#### Однако, чтобы изменить её поведение, мы можем декорировать её, то есть просто передать декоратору,<br />#### который обернет исходную функцию в любой код, который нам потребуется, и вернёт новую,<br />#### готовую к использованию функцию:<br /></span><span style=" font-family:'Courier New'; color:#a9b7c6;">stand_alone_function_decorated = my_shiny_new_decorator(stand_alone_function)<br />stand_alone_function_decorated()<br />```<br />&gt; Наверное</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">теперь<br />мы<br />бы<br />хотели</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">чтобы<br />каждый<br />раз</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">во<br />время<br />вызова<br />stand_alone_function</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">вместо<br />неё<br />вызывалась<br />stand_alone_function_decorated.Для<br />этого<br />просто<br />перезапишем<br />stand_alone_function:<br />```python<br />stand_alone_function = my_shiny_new_decorator(stand_alone_function)<br />stand_alone_function()<br />```<br /><br />&gt; Собственно</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">это<br />и<br />есть<br />декораторы.Вот<br />так<br />можно<br />было<br />записать<br />предыдущий<br />пример</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">используя<br />синтаксис<br />декораторов:<br />```python<br /><br /><br />@</span><span style=" font-family:'Courier New'; color:#bbb529;">my_shiny_new_decorator<br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">another_stand_alone_function</span><span style=" font-family:'Courier New'; color:#a9b7c6;">():<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;Оставь меня в покое&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br /><br />another_stand_alone_function()<br /><br />another_stand_alone_function = my_shiny_new_decorator(another_stand_alone_function)<br />```<br /><br />&gt; Пример<br />с<br />помидорами:<br />```python<br /><br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">bread</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(func):<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">wrapper</span><span style=" font-family:'Courier New'; color:#a9b7c6;">():<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />        func()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&lt;\______/&gt;&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">wrapper<br /><br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">ingredients</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(func):<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">wrapper</span><span style=" font-family:'Courier New'; color:#a9b7c6;">():<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;#помидоры#&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        func()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;~салат~&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">wrapper<br /><br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">sandwich</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(food=</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;--ветчина--&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(food)<br /><br /><br />sandwich()<br />sandwich = bread(ingredients(sandwich))<br />sandwich()<br />```<br />&gt; И<br />используя<br />синтаксис<br />декораторов:<br />```python<br /><br /><br />@</span><span style=" font-family:'Courier New'; color:#bbb529;">bread<br /></span><span style=" font-family:'Courier New'; color:#a9b7c6;">@</span><span style=" font-family:'Courier New'; color:#bbb529;">ingredients<br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">sandwich</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(food=</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;--ветчина--&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(food)<br /><br /><br />sandwich()<br />```</span></pre></body></html>