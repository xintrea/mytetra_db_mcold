<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">Кодировки в python</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">2010-03-27 python кодировки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">прочтение статьи занимает 4мин, с обдумыванием - 10мин :)<br />примечание: данная статья относится к python 2.x, но для python 3.x принцип тот же</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">Общее</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">В python есть </span><span style=" font-family:'FreeMono'; font-size:14px; font-weight:600; color:#6a1009; background-color:#ffffff;">2 объекта работающими с текстом</span><span style=" font-size:14px; color:#333333; background-color:#ffffff;">: unicode и str, объект unicode хранит символы в формате (кодировке) unicode, о</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">бъект </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">str</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> является набором байт/символов в которых python хранит остальные кодировки (utf8, cp1251, cp866, koi8-r и др). Кодировку unicode можно считать </span><span style=" font-family:'FreeMono'; font-size:14px; font-weight:600; color:#6a1009; background-color:#ffffff;">рабочей</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> кодировкой питона т.к. она </span><span style=" font-family:'FreeMono'; font-size:14px; font-weight:600; color:#6a1009; background-color:#ffffff;">предназначена для её использования в самом скрипте</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> - для разных операций над строками. </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">ВнВнешняя</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> кодировка </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-style:italic; color:#333333; background-color:#ffffff;">(объект str)</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> предназначена для хранения и передачи текстовой информации вне скрипта, например для сохранения в файл или передачи по сети. Поэтому в данной статье я её назвал внешней. Самой используемой кодировкой в мире является </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">utf8</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> и число приложений переходящих на эту кодировку растет каждый день, таким образом превращаясь в &quot;стандарт&quot;. Эта кодировка хороша тем что для хранения текста она занимает оптимальное кол-во памяти и с помощью её можно закодировать почти все языки мира ( в отличие от cp1251 и подобных однобайтовых кодировок). </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Поэтому рекомендуется везде использовать utf8, и при написании скриптов.</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#ffffff;">Использование</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1%; font-family:'Open Sans,sans-serif'; font-size:large; font-weight:600; color:#50585d; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1%; font-family:'Open Sans,sans-serif'; font-size:large; font-weight:600; color:#50585d; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1%; font-family:'Open Sans,sans-serif'; font-size:large; font-weight:600; color:#50585d; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1%; font-family:'Open Sans,sans-serif'; font-size:large; font-weight:600; color:#50585d; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Скрипт питона</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">, в самом начале скрипта указываем кодировку файла и сохраняем в ней файл </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># coding: utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">либо</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># -*- coding: utf-8 -*- </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080; background-color:#f5f5f5;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080; background-color:#f5f5f5;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080; background-color:#f5f5f5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">для того что-бы интерпретатор python понял в какой кодировке файл </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Строки в скрипте</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> Строки в скрипте хранятся байтами, от кавычки до кавычки: </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">print 'Привет'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">= 6 байт при cp1251 = 12 байт при utf8 Если перед строкой добавить символ </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">u</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">, то при запуске скрипта, эта байтовая строка будет декодирована в unicode из кодировки указанной в начале:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># coding:utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">print u'Привет'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">и если кодировка содержимого в файле отличается от указанной, то в строке могут быть &quot;битые символы&quot; </span><span style=" font-family:'FreeMono'; font-size:14px; font-weight:600; color:#6a1009; background-color:#ffffff;">Загрузка и сохранение файла </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># coding: utf8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># Загружаем файл с кодировкай utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">text = open('file.txt','r').read()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># Декодируем из utf8 в unicode - из внешней в рабочую</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">text = text.decode('utf8')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># Работаем с текстом</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">text += text</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># Кодируем тест из unicode в utf8 - из рабочей во внешнюю</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">text = text.encode('utf8')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># Сохраняем в файл с кодировкий utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">open('file.txt','w').write(text)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Текст в скрипте</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;"># coding: utf8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;">a = 'Текст в utf8'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;">b = u'Текст в unicode'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;"># Эквивалентно: b = 'Текст в unicode'.decode('utf8')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;"># т.к. сам скрипт хранится в utf8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; font-size:13px; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;">print 'a =',type(a),a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;"># декодируем из utf-8 в unicode и далее unicode в cp866 (кодировка консоли winXP ru)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;">print 'a2 =',type(a),a.decode('utf8').encode('cp866')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009; background-color:#f5f5f5;">print 'b =',type(b),b</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; font-size:13px; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">Процедуре </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">print</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> текст желательно передавать в рабочей кодировке либо кодировать в кодировку ОС. Результат скрипта при запуске из консоли windows XP: </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">a = &lt;type 'str'&gt; ╨в╨╡╨║╤Б╤В ╨▓ utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">a2 = &lt;type 'str'&gt; Текст в utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">b = &lt;type 'unicode'&gt; Текст в unicode</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">В последней строке </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">print</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> преобразовал unicode в cp866 автоматический, см. следующий пункт </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Авто-преобразование кодировки</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> В некоторых случаях для упрощения разработки python делает преобразование кодировки, пример с методом </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">print</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> можно посмотреть в предыдущем пункте. В примере ниже, python сам переводит utf8 в unicode - приводит к одной кодировке для того что-бы сложить строки. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080;"># coding: utf8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; font-size:13px; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;"># Устанавливаем стандартную внешнюю кодировку = utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">import sys</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">reload(sys)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">sys.setdefaultencoding('utf8')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; font-size:13px; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">a = 'Текст в utf8'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">b = u'Текст в unicode'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">c = a + b</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; font-size:13px; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">print 'a =',type(a),a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">print 'b =',type(b),b</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-size:13px; color:#6a1009;">print 'c =',type(c),c</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; font-size:13px; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">Результат</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">a = &lt;type 'str'&gt; Текст в utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">b = &lt;type 'unicode'&gt; Текст в unicode</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009; background-color:#f5f5f5;">c = &lt;type 'unicode'&gt; Текст в utf8Текст в unicode</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">Как видим результирующая строка &quot;c&quot; в unicode.</span><span style=" font-family:'FreeMono'; font-size:14px; font-weight:600; color:#6a1009; background-color:#ffffff;"> Если бы кодировки строк совпадали то авто-перекодирования не произошло бы и результирующая строка содержала кодировку слагаемых строк. Авто-перекодирование</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> обычно срабатывает когда происходит взаимодействие разных кодировок. </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Пример авто-преобразования кодировок в сравнении</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;"># coding: utf8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;"># Устанавливаем стандартную внешнюю кодировку = utf8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">import sys</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">reload(sys)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">sys.setdefaultencoding('utf8')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">print '1. utf8 and unicode', 'true' if u'Слово'.encode('utf8') == u'Слово' else 'false'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">print '2. utf8 and cp1251', 'true' if u'Слово'.encode('utf8') == u'Слово'.encode('cp1251') else 'false'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">print '3. cp1251 and unicode', 'true' if u'Слово'.encode('cp1251') == u'Слово' else 'false'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">Результат </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#f5f5f5;">1. utf8 and unicode true</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">2. utf8 and cp1251 false</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">script.py:10: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">  print '3. cp1251 and unicode', 'true' if u'Слово'.encode('cp1251') == u'Слово' else 'false'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">3. cp1251 and unicode false</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:14px; color:#333333;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14px; color:#333333; background-color:#ffffff;">В сравнении 1, кодировка utf8</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> преобразовалась в unicode и сравнение произошло корректно. В сравнении 2, сравниваются кодировки одного вида - обе внешние, т.к. кодированы они в разных кодировках условие выдало что они не равны. В сравнении 3, выпало предупреждение из за того что выполняется сравнение кодировок разного вида - рабочая и внешняя, а авто-декодирование не произошло т.к. стандартная внешняя кодировка = utf8, и декодировать строку в кодировке cp1251 методом utf8 питон не смог. </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Вывод списков</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080;"># coding: utf8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-style:italic; color:#408080; background-color:#f5f5f5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">d </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> [</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'Тест'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">,</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'списка'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333; background-color:#f5f5f5;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#008000;">print</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'1'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">,d</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#008000;">print</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'2'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">,d</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">.</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">__repr__()</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#008000;">print</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'3'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">,</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">','</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">.</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">join(d)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">Результат:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">1</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> [</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#bb6622;">\xd0\xa2\xd0\xb5\xd1\x81\xd1\x82</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#bb6622;">\xd1\x81\xd0\xbf\xd0\xb8\xd1\x81\xd0\xba\xd0\xb0</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">2</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> [</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#bb6622;">\xd0\xa2\xd0\xb5\xd1\x81\xd1\x82</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">, </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; font-weight:600; color:#bb6622;">\xd1\x81\xd0\xbf\xd0\xb8\xd1\x81\xd0\xba\xd0\xb0</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#ba2121;">'</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">]</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">3</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;"> Тест,списка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">При выводе списка, происходит вызов [{</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; text-decoration: underline; color:#333333; background-color:#ffffff;">repr</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;">}]() который возвращает внутреннее представление этого спиcка - print 1 и 2 являются аналогичными. Для корректного вывода списка, его нужно преобразовать в строку - print 3. </span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; font-weight:696; color:#333333; background-color:#ffffff;">Установка внешней кодировки при запуске</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:14px; color:#333333; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.42857%; background-color:#f5f5f5;"><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">PYTHONIOENCODING</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">=</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">utf8 python </span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#666666;">1.</span><span style=" font-family:'Menlo,Monaco,Consolas,Courier New,monospace'; font-size:13px; color:#333333;">py</span></p></body></html>