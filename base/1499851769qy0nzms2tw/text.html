<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:7px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.8host.com/blog/redaktirovanie-fajla-sudoers-v-ubuntu-i-centos/"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; text-decoration: underline; color:#000000; text-transform:uppercase;">РЕДАКТИРОВАНИЕ ФАЙЛА SUDOERS В UBUNTU И CENTOS</span></a><img src="image12292.png" /><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Март 17, 2016 12:01 пп</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image985.png" /><a href="https://www.8host.com/blog/category/centos/"><span style=" font-family:'inherit'; font-size:8.25pt; text-decoration: underline; color:#0076a7;">Centos</span></a><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">, </span><a href="https://www.8host.com/blog/category/linux/"><span style=" font-family:'inherit'; font-size:8.25pt; text-decoration: underline; color:#0076a7;">Linux</span></a><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">, </span><a href="https://www.8host.com/blog/category/ubuntu/"><span style=" font-family:'inherit'; font-size:8.25pt; text-decoration: underline; color:#0076a7;">Ubuntu</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Published by </span><a href="https://www.8host.com/blog/author/amber/"><span style=" font-family:'inherit'; font-size:8.25pt; text-decoration: underline; color:#0076a7; background-color:#ffffff;">Amber</span></a><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;"> </span><a href="https://www.8host.com/blog/redaktirovanie-fajla-sudoers-v-ubuntu-i-centos/#respond"><span style=" font-family:'inherit'; font-size:8.25pt; text-decoration: underline; color:#0076a7; background-color:#ffffff;">Leave your thoughts</span></a></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Разделение прав доступа – одна из наиболее важных парадигм безопасности, реализуемых в Linux и Unix-подобных операционных системах. Обычные пользователи работают с ограниченными правами; так сокращаются масштабы их влияния на их собственную среду и на операционную систему в целом.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Пользователь root имеет привилегии суперпользователя. Эта учетная запись администратора не имеет ограничений, которые присутствуют на учётных записях обычных пользователей. Другие пользователи могут выполнять команды с правами root в ряде отдельных случаев.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В данном руководстве показано, как правильно и безопасно для системы передавать права root.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; color:#444444;">Примечание</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">: Данное руководство было выполнено на сервере Ubuntu 12.04, однако большинство современных дистрибутивов Linux будут вести себя аналогичным образом.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Для выполнения руководства нужно предварительно выполнить начальную настройку сервера:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.8host.com/blog/nachalnaya-nastrojka-servera-ubuntu-12-04/"><span style=" text-decoration: underline; color:#0076a7;">Начальная настройка сервера Ubuntu 12.04</span></a></li>
<li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.8host.com/blog/nachalnaya-nastrojka-servera-centos-7/"><span style=" text-decoration: underline; color:#0076a7;">Начальная настройка сервера CentOS 7</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Войдите на сервер как не-root пользователь.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Как получить права root</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Есть три основных способа получить привилегии суперпользователя, которые варьируются по уровню сложности.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Вход как root</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Проще всего, конечно, войти в систему как пользователь root.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">При подключении через SSH укажите IP-адрес или имя хоста:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">ssh root@IP_адрес_или_домен</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">По запросу введите root-пароль.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Команда su</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Постоянно использовать учётную запись root не рекомендуется, поскольку, имея абсолютные права доступа, можно совершенно случайно нанести системе непоправимый вред.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Потому в системе существует команда su, позволяющая обычному пользователю получать root-права в любой момент.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; color:#444444;">Примечание</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">: Команда su – это сокращение от substitute user.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Итак, чтобы получить root-права, просто введите:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">su</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Система запросит пароль root-пользователя, после чего откроет доступ к сессии оболочки root-пользователя.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Выполнив все задачи, требующие прав root, можно вернуться в предыдущую сессию:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">exit</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Команда sudo</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Последний способ получения привилегий root – команда sudo.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Команда sudo позволяет выполнять отдельные команды с правами root без необходимости открывать новую сессию.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo command_to_execute</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; color:#444444;">Примечание</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">: В отличие от su, команда sudo запрашивает не пароль root, а пароль пользователя, который вызывает команду.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Из соображений безопасности команда sudo недоступна по умолчанию, доступ к ней нужно настраивать. Если вы следовали руководству по начальной настройке сервера, вы уже знаете, как это делается.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Что такое Visudo?</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Команда sudo настраивается при помощи файла /etc/sudoers.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; color:#444444;">Важно!</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> Никогда не редактируйте этот файл при помощи обычного текстового редактора! </span><span style=" font-family:'FreeMono'; font-weight:600; color:#6a1009;">Для этого следует использовать visudo.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Неправильный синтаксис, добавленный в этот файл, может полностью нарушить распределение прав между пользователями. Потому для работы с этим файлом используется команда visudo.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Команда visudo открывает файл в обычном текстовом редакторе, но во время сохранения файла проверяет его синтаксис. Это позволяет избежать ошибок в конфигурации.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Как правило, visudo открывает файл /etc/sudoers в редакторе vi. В системе Ubuntu visudo использует nano.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Чтобы настроить команду visudo для использования vi в системе Ubuntu, выполните команду:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo update-alternatives --config editor</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">There are 3 choices for the alternative editor (providing /usr/bin/editor).</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"><br />Selection    Path                Priority   Status<br />————————————————————<br />* 0            /bin/nano          40        auto mode<br />1            /bin/nano           40        manual mode<br />2            /usr/bin/vim.basic   30        manual mode<br />3            /usr/bin/vim.tiny    10        manual mode</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Выберите число, соответствующее текстовому редактору, который вы хотите использовать.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В системе CentOS это значение можно изменить, добавив в ~/.bashrc строку:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">export EDITOR=/path/to/editor</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Чтобы обновить настройки, введите:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">. ~/.bashrc</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Чтобы открыть /etc/sudoers, введите:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo visudo</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Редактирование файла sudoers</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Итак, в выбранном вами текстовом редакторе на экране откроется файл sudoers.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Ниже приведены параметры файла системы Ubuntu 12.04 (закомментированные строки опущены, а изменения, внесённые при начальной настройке сервера, сохранены).</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; color:#444444;">Примечание</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">: Файл sudoers системы CentOS гораздо более объёмен; некоторые его параметры в этом руководстве не описаны.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">Defaults        env_reset<br />Defaults        secure_path=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;<br />root        ALL=(ALL:ALL) ALL<br />demo        ALL=(ALL:ALL) ALL<br />%admin      ALL=(ALL) ALL<br />%sudo       ALL=(ALL:ALL) ALL</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Стандартные параметры</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Первая строка, Defaults env_reset, сбрасывает терминальную среду, чтобы удалить все пользовательские переменные. Эта мера безопасности используется для устранения потенциально вредного воздействия переменных среды из сессии sudo.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Второй параметр, Defaults secure_path=…, задаёт путь (PATH, точки файловой системы, в которых ОС будет искать приложения) для операций sudo. Это предотвращает использование потенциально опасных пользовательских путей.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Параметры настройки прав пользователей</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Третий и четвёртый параметр должны быть вам знакомы. Четвёртую строку вы добавили самостоятельно, но, возможно, не разбирали её подробно.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">demo  ALL=(ALL:ALL) ALL</li>
<li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Первое поле задаёт имя пользователя, к которому нужно применить данное правило (в данном случае это demo).</li>
<li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Первое ALL значит, что правило будет применяться ко всем хостам.</li>
<li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Второе ALL значит, что указанный пользователь может запускать команды в сессии любого пользователя.</li>
<li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Третье ALL значит, что указанный пользователь может запускать команды в любой группе.</li>
<li style=" font-family:'inherit'; font-size:8.25pt; color:#444444;" style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Последнее ALL указывает, что эти правила нужно применять ко всем командам.</li></ul>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Это значит, что пользователи root и demo могут запускать все команды при помощи sudo, указав свой пароль.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Параметры привилегий групп</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Последние две строки похожи на параметры привилегий пользователей, однако они отвечают за права групп.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Имена групп начинаются с символа %.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Как видите, группа admin может выполнять любую команду как любой пользователь или хост. Аналогичные права имеет группа sudo, однако она также может запускать команду как любая группа.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Пользовательские правила</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Ознакомившись с базовым синтаксисом файла, попробуйте создать пару правил самостоятельно.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Создание алиасов</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Файл sudoers можно более удобно структурировать при помощи различных алиасов (англ. – alias).</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">К примеру, можно создать три разные группы пользователей с совмещёнными правами:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">User_Alias      GROUPONE = abby, brent, carl<br />User_Alias      GROUPTWO = brent, doris, eric,<br />User_Alias      GROUPTHREE = doris, felicia, grant</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Имена групп должны начинаться с большой буквы. После этого можно дать пользователям GROUPTWO право на изменение БД apt-get:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">GROUPTWO    ALL = /usr/bin/apt-get update</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Если в правиле не указан пользователь и группа, по умолчанию sudo использует root.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Затем можно разрешить пользователям группы GROUPTHREE выключать и перезапускать машину; для этого нужно создать алиас команды:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">Cmnd_Alias      POWER = /sbin/shutdown, /sbin/halt, /sbin/reboot, /sbin/restart<br />GROUPTHREE  ALL = POWER</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Алиас команды POWER содержит команды для отключения и перезапуска машины.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Также можно создать алиас Run as, который заменяет часть правила, указывающую пользователя, в сессии которого нужно выполнить команду.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">Runas_Alias     WEB = www-data, apache<br />GROUPONE    ALL = (WEB) ALL</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Теперь любой пользователь группы GROUPONE может выполнять команды в сессиях пользователей www-data или apache.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'inherit'; font-size:8.25pt; font-weight:696; color:#444444;">Примечание</span><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">: Помните, что созданные ранее правила имеют более высокий приоритет в случае конфликта правил.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Блокировка правил</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Существует ряд способов контроля поведения и реакции sudo на вызов.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">К примеру, команда updatedb в сочетании с пакетом mlocate относительно безвредна. Чтобы обычный пользователь мог выполнять её с привилегиями суперпользователя, не вводя пароль, можно создать такое правило:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">GROUPONE    ALL = NOPASSWD: /usr/bin/updatedb</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Команда NOPASSWD значит, что система не будет запрашивать пароль. Также существует команда PASSWD, которая отвечает за противоположное поведение и используется по умолчанию.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">NOPASSWD распространяется на всё правило, если команда PASSWD не отменяет его. Например, строка может выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">GROUPTWO    ALL = NOPASSWD: /usr/bin/updatedb, PASSWD: /bin/kill</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Ещё одна удобная команда – NOEXEC, которая используется для предотвращения опасного поведения определенных программ. К примеру, некоторые команды, такие как less, могут вызывать другие команды:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">!command_to_run</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Эта команда выполняет любую команду с привилегиями пользователя, запускающего less, а это может быть очень опасно.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Чтобы запретить такое поведение, можно использовать следующую строку:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">username    ALL = NOEXEC: /usr/bin/less</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Дополнительные сведения</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В данном разделе собраны различные полезные советы по работе с sudo.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Если вы указали пользователя или группу в параметре Run as, вы можете выполнять команды в сессии этого пользователя при помощи флагов -u и –g соответственно:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo -u run_as_user command<br />sudo -g run_as_group command</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">По умолчанию sudo сохраняет учётные данные в одном терминале на некоторое время. Это означает, что в течение этого периода вам не придется вводить пароль снова.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Если в целях безопасности вы хотите сбросить этот таймер, используйте команду:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo -k</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Чтобы узнать права пользователя, введите:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo -l</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Эта команда выведет все права, указанные в файле /etc/sudoers для данного пользователя.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Если обычный пользователь попытается запустить команду администратора без префикса sudo, команда не сработает. Чтобы  избежать необходимости повторного ввода команды, используйте функцию bash, которая повторяет команду:</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New,monospace'; font-size:8.25pt; color:#444444; background-color:rgba(144,144,144,0.07451);">sudo !!</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Двойной восклицательный знак повторит последнюю команду.</span></p>
<p style=" margin-top:0px; margin-bottom:13px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Exo 2,sans-serif'; font-size:8.25pt; font-weight:696; color:#222222; background-color:#ffffff;">Заключение</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Теперь у вас есть базовые навыки работы с файлом sudoers и правами root.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Работая с правами суперпользователя, помните о том, что обычные пользователи не обладают такими правами по умолчанию из соображений безопасности. Не злоупотребляйте правами root, иначе можно случайно нанести системе непоправимый ущерб.</span></p></body></html>