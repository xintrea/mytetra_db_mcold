<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#2b2b2b;"><span style=" font-family:'Courier New'; color:#808080;"># coding: utf-8<br /><br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">import </span><span style=" font-family:'Courier New'; color:#a9b7c6;">gi<br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">import </span><span style=" font-family:'Courier New'; color:#a9b7c6;">SendKeys<br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">from </span><span style=" font-family:'Courier New'; color:#a9b7c6;">peewee </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">import </span><span style=" font-family:'Courier New'; color:#a9b7c6;">*<br />gi.require_version(</span><span style=" font-family:'Courier New'; color:#a5c261;">'Gtk'</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a5c261;">'3.0'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">import </span><span style=" font-family:'Courier New'; color:#a9b7c6;">gi.repository.Gtk </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">as </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Gtk<br /><br /><br /><br />file = </span><span style=" font-family:'Courier New'; color:#a5c261;">'resource.txt'<br /></span><span style=" font-family:'Courier New'; color:#a9b7c6;">db = SqliteDatabase(</span><span style=" font-family:'Courier New'; color:#a5c261;">'ChaineRs.db'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br /></span><span style=" font-family:'Courier New'; color:#808080;"># Model for database<br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">class </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">Chain</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(Model):<br />    id = IntegerField(</span><span style=" font-family:'Courier New'; color:#aa4926;">unique</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />    c_item = CharField()<br />    id_root = IntegerField()<br />    id_parent = IntegerField()<br />    id_previous = IntegerField()<br />    id_next = IntegerField()<br />    b_root = BooleanField()             </span><span style=" font-family:'Courier New'; color:#808080;"># True = root of branch -&gt; c_item = Name of branch<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">class </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">Meta</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />        database = db<br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">next_id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(instance):<br />    </span><span style=" font-family:'Courier New'; color:#808080;"># find max value of temp_id in model<br />    # increment it by one and assign it to model instance object<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />        e = instance.</span><span style=" font-family:'Courier New'; color:#b200b2;">__name__ </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#a5c261;">'.select(fn.Max(' </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ instance.</span><span style=" font-family:'Courier New'; color:#b200b2;">__name__ </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#a5c261;">'.id))[0].id + 1'<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># next_value = Poet.select(fn.Max(Poet.id))[0].id + 1<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">next_value = </span><span style=" font-family:'Courier New'; color:#8888c6;">eval</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(e)<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />        next_value = </span><span style=" font-family:'Courier New'; color:#6897bb;">1<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">next_value<br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">class </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">HeaderBarWindow</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(Gtk.ApplicationWindow):<br />    d_data = </span><span style=" font-family:'Courier New'; color:#8888c6;">dict</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />    l_data = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />    n_cur = </span><span style=" font-family:'Courier New'; color:#6897bb;">0                   </span><span style=" font-family:'Courier New'; color:#808080;"># cursor to 1-st element of l_data -&gt; self.l_data[self.n_cur]<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id = </span><span style=" font-family:'Courier New'; color:#6897bb;">0                 </span><span style=" font-family:'Courier New'; color:#808080;"># current id<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_level = </span><span style=" font-family:'Courier New'; color:#6897bb;">0            </span><span style=" font-family:'Courier New'; color:#808080;"># level parentage by default<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_root = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_previous = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_next = -</span><span style=" font-family:'Courier New'; color:#6897bb;">1<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_paramount = </span><span style=" font-family:'Courier New'; color:#6897bb;">0        </span><span style=" font-family:'Courier New'; color:#808080;"># id of chosen root for filter<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">False     </span><span style=" font-family:'Courier New'; color:#808080;"># define to update or to save item<br /><br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">root = </span><span style=" font-family:'Courier New'; color:#a5c261;">''<br /><br /><br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; color:#b200b2;">__init__</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">,  </span><span style=" font-family:'Courier New'; color:#a9b7c6;">*args</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">**kwargs):<br />        </span><span style=" font-family:'Courier New'; color:#8888c6;">super</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(HeaderBarWindow</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">).</span><span style=" font-family:'Courier New'; color:#b200b2;">__init__</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(*args</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">**kwargs)<br /><br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.set_border_width(</span><span style=" font-family:'Courier New'; color:#6897bb;">10</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.set_default_size(</span><span style=" font-family:'Courier New'; color:#6897bb;">400</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">100</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)         </span><span style=" font-family:'Courier New'; color:#808080;"># size of window<br /><br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">hb = Gtk.HeaderBar()                    </span><span style=" font-family:'Courier New'; color:#808080;"># TitleBar<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">hb.set_show_close_button(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#hb.props.title = &quot;ChaineR&quot;<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.set_titlebar(hb)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># number of rows and columns in table<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row = </span><span style=" font-family:'Courier New'; color:#6897bb;">9<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col = </span><span style=" font-family:'Courier New'; color:#6897bb;">9<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># level of buttons<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_1 = </span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(n_row / </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        y_level_2 = y_level_1 + </span><span style=" font-family:'Courier New'; color:#6897bb;">1<br /><br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">table = Gtk.Table(n_row</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># ComboBox<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_store = Gtk.ListStore(</span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo = Gtk.ComboBox.new_with_model_and_entry(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_store)<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># insert roots<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">l_combo = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_roots()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">i </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_combo)):<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_store.append([</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">l_combo[i]])             </span><span style=" font-family:'Courier New'; color:#808080;"># </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: change 1 to new id<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: do likewise<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># data depends of chosen root<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;changed&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_data)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.set_entry_text_column(</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        hb.add(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># button add root<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_add_root = Gtk.Button(</span><span style=" font-family:'Courier New'; color:#a5c261;">'+'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        hb.add(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_add_root)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_add_root.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;clicked&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_root</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># filter<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_entry = Gtk.Entry()<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_entry</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">3</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_entry.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">'key_press_event'</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_like</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)  </span><span style=" font-family:'Courier New'; color:#808080;"># enter event<br /><br />        # button left<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_left = Gtk.Button(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&lt;&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#self.b_left.add(Gtk.Arrow(Gtk.ArrowType.LEFT, Gtk.ShadowType.NONE))<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_left</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_2)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># editor<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry = Gtk.Entry()<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># self.entry.connect('key_press_event', self.rewrite, None)                   # write data<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_2)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># button right<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_right = Gtk.Button(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&gt;&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#self.b_right.add(Gtk.Arrow(Gtk.ArrowType.RIGHT, Gtk.ShadowType.NONE))<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_right</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_2)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_right.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;clicked&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_child</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># button up<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up = Gtk.Button()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.add(Gtk.Arrow(Gtk.ArrowType.UP</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Gtk.ShadowType.NONE))<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(n_col / </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(n_col / </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">) + </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;clicked&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_prev</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># button down<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down = Gtk.Button()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down.add(Gtk.Arrow(Gtk.ArrowType.DOWN</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Gtk.ShadowType.NONE))<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(n_col / </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(n_col / </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">) + </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;clicked&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_next</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># button for save data<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_save = Gtk.Button(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;Save&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_save</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_save.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;clicked&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># button for delete item<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_delete = Gtk.Button(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;Delete&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_delete</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_row)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_delete.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;clicked&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.delete_item</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># label previous<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev = Gtk.Label()<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_1 - </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_1 - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># label next<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next = Gtk.Label()<br />        table.attach(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">n_col - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_2 + </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">y_level_2 + </span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.add(table)<br /><br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_data</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">combo):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Take data of the root chosen of user<br />        And write to controlls<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text() == </span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:         </span><span style=" font-family:'Courier New'; color:#808080;"># если происходит смена root-а то записываем изменения<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_or_update_row()<br /><br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># hide buttons<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.hide()<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#self.b_down.hide()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_left.hide()<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#self.b_right.hide()<br /><br />        # make empty data<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d = </span><span style=" font-family:'Courier New'; color:#8888c6;">dict</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data = d<br />        l = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data = l<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># make empty controlls<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># переписываем уровень с предком в качестве рута<br />        # </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: при смещении вправо предком нужно записывать предыдущий элемент<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># take_data используется только в первоначальной загрузке поэтому пишу сюда<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># переписываем уровень с предком в качестве предыдущего элемента<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root<br /><br />        tree_iter = combo.get_active_iter()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">tree_iter != </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            model = combo.get_model()<br />            row_id</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.root = model[tree_iter][:</span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_id_root()  </span><span style=" font-family:'Courier New'; color:#808080;"># define self.id_root by self.root<br />                #print(self.id_level)<br />                # take data of the root<br />                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.select_data()  </span><span style=" font-family:'Courier New'; color:#808080;"># select data to self.d_data and self.l_data<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">pass<br />                </span><span style=" font-family:'Courier New'; color:#808080;">#print(&quot;Can't find root&quot;)<br />        #print(&quot;self.n_cur - &quot; + str(self.n_cur))<br />        #if l:  # contain objects<br />            # write to controlls<br />        #    self.write_to_controlls_default()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">select_data</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function select data and set text to controllers<br />        Take id root and id level of objects of this root<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#self.test_print()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.id_root == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">and </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.id_parent == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root).order_by(<br />                Chain.id.asc()):<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[c.id] = c.c_item    </span><span style=" font-family:'Courier New'; color:#808080;"># insert data into dictionary<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data.append(c.id)        </span><span style=" font-family:'Courier New'; color:#808080;"># write id-s to list for circle<br />        # set text to controllers<br />        #try:<br />        #    self.entry.set_text(self.d_data[self.l_data[0]])<br />        #except:<br />        #    pass<br />        #try:<br />        #    self.l_next.set_label(self.d_data[self.l_data[1]])<br />        #except:<br />        #    pass<br /><br /><br /><br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]) </span><span style=" font-family:'Courier New'; color:#808080;"># прописываем данные по 1-ому элементу если он есть<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.write_cont_first()     </span><span style=" font-family:'Courier New'; color:#808080;"># прописываем контроллы<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">True     </span><span style=" font-family:'Courier New'; color:#808080;"># as it is -&gt; just to update item<br />            #self.test_print()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;Im here&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = next_id(Chain)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_id_root()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_parent = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#808080;">#elf.id_next = 0<br />            #elf.b_root = False<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;and here&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = next_id(Chain)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.take_id_root()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_parent = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_root = </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># устанавливаем видимость кнопки если есть следующий<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_next():<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># устанавливаем видимость кнопки потомка если есть потомок<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_child():<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_right.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_right.set_label(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;+&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_right.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_entry == </span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_like()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_to_controlls_default</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function write data into controlls in default loading<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#self.n_cur = self.l_data[0]                             # cursor into 1-st element list of data<br />        #self.l_prev.set_label(self.d_data[self.n_cur - 1])<br />        #print(&quot;self.d_data - &quot; + str(self.d_data))<br />        #print(&quot;self.l_data - &quot; + str(self.l_data))<br />        #print(&quot;self.n_cur - &quot; + str(self.n_cur))<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur]])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur + </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)                   </span><span style=" font-family:'Courier New'; color:#808080;"># empty if not exist<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_to_controlls</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function write data into controlls<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]])<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur]])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur + </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)                   </span><span style=" font-family:'Courier New'; color:#808080;"># empty if not exist<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_nothing_to_controlls</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function write data into controlls<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#print(&quot;self.n_cur - &quot; + str(self.n_cur))<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_data[</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur - </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]])<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)         </span><span style=" font-family:'Courier New'; color:#808080;"># empty if not exist<br />#        self.l_next.set_label('')                   # empty if not exist<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">rewrite_data</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        f = </span><span style=" font-family:'Courier New'; color:#8888c6;">open</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(file</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a5c261;">'w'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        l_data = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />        num = </span><span style=" font-family:'Courier New'; color:#6897bb;">1  </span><span style=" font-family:'Courier New'; color:#808080;"># number of line<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">i </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data.items())):<br />            l_data.append(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(i)])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">i </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_data)):<br />            line = </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(num) + </span><span style=" font-family:'Courier New'; color:#a5c261;">'--' </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ l_data[i] + </span><span style=" font-family:'Courier New'; color:#a5c261;">'</span><span style=" font-family:'Courier New'; color:#cc7832;">\n</span><span style=" font-family:'Courier New'; color:#a5c261;">'<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">f.write(line)<br />            num = num + </span><span style=" font-family:'Courier New'; color:#6897bb;">1<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">f.close()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_data</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        f = </span><span style=" font-family:'Courier New'; color:#8888c6;">open</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(file</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a5c261;">'w'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        l_data = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />        num = </span><span style=" font-family:'Courier New'; color:#6897bb;">1  </span><span style=" font-family:'Courier New'; color:#808080;"># number of line<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">i </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data.items())):<br />            l_data.append(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.d_data[</span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(i)])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">i </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_data)):<br />            line = </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(num) + </span><span style=" font-family:'Courier New'; color:#a5c261;">'--' </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ l_data[i] + </span><span style=" font-family:'Courier New'; color:#a5c261;">'</span><span style=" font-family:'Courier New'; color:#cc7832;">\n</span><span style=" font-family:'Courier New'; color:#a5c261;">'<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">f.write(line)<br />            num = num + </span><span style=" font-family:'Courier New'; color:#6897bb;">1<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">f.close()<br /><br />    </span><span style=" font-family:'Courier New'; color:#808080;"># заведение записи через entry<br />    # работает<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">rewrite</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">event=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function rewrite/write data in controll entry-editor<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> event:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># if row exist -&gt; rewrite<br />        # else insert<br /><br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_or_update_row()<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># make visible button<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">delete_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">event=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Delete item from system<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> event:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># rewrite relationships<br />        # update id_next for previous item<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.update(**{</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_next'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">: </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next}).where(Chain.id == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous).execute()<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># update id_previous for next item<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.update(**{</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_previous'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">: </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous}).where(Chain.id == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next).execute()<br /><br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next == -</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            t_id_next = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next            </span><span style=" font-family:'Courier New'; color:#808080;"># temp variable for delete item<br />            # delete item<br />            #Chain.delete().where(Chain.id == self.id).execute()<br /><br />            # move to next<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = t_id_next<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.write_cont()                   </span><span style=" font-family:'Courier New'; color:#808080;"># rewrite controlls<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:                                   </span><span style=" font-family:'Courier New'; color:#808080;"># if last item<br />            # delete item<br />            #Chain.delete().where(Chain.id == self.id).execute()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">select_dict_id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function take dictionary of values of taken id<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d = </span><span style=" font-family:'Courier New'; color:#8888c6;">dict</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br /><br />        c = Chain.get(Chain.id == id_item)<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.id<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'c_item'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.c_item<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_root'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.id_root<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_parent'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.id_parent<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_previous'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.id_previous<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_next'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.id_next<br />        d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'b_root'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">] = c.b_root<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">rewrite_class_data</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function rewrite data from id data in DB<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br />        d = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.select_dict_id(id_item)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root = d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_root'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level = d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_parent'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous = d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_previous'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next = d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_next'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.root = d[</span><span style=" font-family:'Courier New'; color:#a5c261;">'c_item'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return<br /><br />    def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">insert_row</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Insert row<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = next_id(Chain)<br />        Chain.create(</span><span style=" font-family:'Courier New'; color:#aa4926;">id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=id_item</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">c_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text()</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">b_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">False</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">insert_or_update_row</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function insert or update row<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#if self.entry.get_text() == '':<br />        #    return<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = next_id(Chain)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update == </span><span style=" font-family:'Courier New'; color:#8888c6;">False</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:       </span><span style=" font-family:'Courier New'; color:#808080;"># if not just update -&gt; insert otherwise -&gt; update<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.create(</span><span style=" font-family:'Courier New'; color:#aa4926;">id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=id_item</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">c_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text()</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_next</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=-</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">b_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">False</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data(id_item)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            Chain.update(**{</span><span style=" font-family:'Courier New'; color:#a5c261;">'c_item'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">: </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text()}).where(Chain.id == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id).execute()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            Chain.update(**{</span><span style=" font-family:'Courier New'; color:#a5c261;">'id_next'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">: </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id}).where(Chain.id == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous).execute()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;None previous element!&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">pass<br /><br /><br />    def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">combo):<br />        </span><span style=" font-family:'Courier New'; color:#808080;">### insert &amp; update text in controls<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">tree_iter = combo.get_active_iter()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">tree_iter != </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            model = combo.get_model()<br />            </span><span style=" font-family:'Courier New'; color:#808080;">name_item </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= model[tree_iter][:</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />            </span><span style=" font-family:'Courier New'; color:#808080;">### </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: update controlls<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            entry = combo.get_child()<br />            cv_item = entry.get_text()  </span><span style=" font-family:'Courier New'; color:#808080;"># text from ListStore - ComboBox<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">idv_parent = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">idv_previous = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#808080;"># insert data<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.create(</span><span style=" font-family:'Courier New'; color:#aa4926;">id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=next_id(Chain)</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">c_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=cv_item</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=idv_parent</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=idv_previous</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">b_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">on_maximize_toggle</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">action</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">value):<br />        action.set_state(value)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">value.get_boolean():<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.maximize()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.unmaximize()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_next</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Take next item<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_or_update_row()<br /><br />        text = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># перезаписываем предыдущий label текущим entry<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev.set_label(text)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># делаем пустым entry<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># сохраняем id как id_previous<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># если есть следующий элемент, то переписываем данные и переписываем контроллы<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_next():<br />            </span><span style=" font-family:'Courier New'; color:#808080;">#self.insert_or_update_row()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.test_print()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.write_cont()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">True  </span><span style=" font-family:'Courier New'; color:#808080;"># as it is -&gt; just to update item<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">False  </span><span style=" font-family:'Courier New'; color:#808080;"># as it is -&gt; insert item<br /><br />        # устанавливаем видимость кнопки если есть следующий<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_next():<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_prev</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Go to previous items<br />        Change text in items<br />        Work from signal of button<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button: b_prev<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data: None<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># перезаписываем entry текущим label previous<br />        # self.entry.set_text(self.l_prev.get_text())<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_or_update_row()<br /><br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_previous():<br />            </span><span style=" font-family:'Courier New'; color:#808080;"># перезаписываем label next текущим entry<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text())<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data()<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.write_cont()<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_previous():<br />                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.hide()<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># устанавливаем видимость кнопки если есть следующий<br />    # устанавливаем видимость кнопки если есть следующий<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_next():<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_down.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">True  </span><span style=" font-family:'Courier New'; color:#808080;"># as it is -&gt; just to update item<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">False  </span><span style=" font-family:'Courier New'; color:#808080;"># just to insert<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_child</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()              </span><span style=" font-family:'Courier New'; color:#808080;"># clear controlls<br /><br />        # change id_parent<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># show child if it is<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_child():                   </span><span style=" font-family:'Courier New'; color:#808080;"># if he has a child<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">True             </span><span style=" font-family:'Courier New'; color:#808080;"># can just update<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.select_first_child())<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.write_cont()<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># else empty<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">False            </span><span style=" font-family:'Courier New'; color:#808080;"># can just insert<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># меняем id_parent<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data()   </span><span style=" font-family:'Courier New'; color:#808080;"># переписываем данные<br /><br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">on_name_combo_changed</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">combo):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function for work with combo<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> combo: control ComboBox<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">tree_iter = combo.get_active_iter()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">tree_iter != </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            model = combo.get_model()<br />            </span><span style=" font-family:'Courier New'; color:#808080;">row_id</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">name </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= model[tree_iter][:</span><span style=" font-family:'Courier New'; color:#6897bb;">2</span><span style=" font-family:'Courier New'; color:#a9b7c6;">]<br />            </span><span style=" font-family:'Courier New'; color:#808080;">#print(&quot;Selected: ID=%d, name=%s&quot; % (row_id, name))<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#808080;">entry </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= combo.get_child()<br />            </span><span style=" font-family:'Courier New'; color:#808080;">### </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: insert into database root row<br /><br /><br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">find_like</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">event=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data = None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Find item which like data in filter<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> event:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text() == </span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:         </span><span style=" font-family:'Courier New'; color:#808080;"># если происходит фильтрация<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_or_update_row()<br /><br />        entry = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.get_child()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">entry.get_text() == </span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:             </span><span style=" font-family:'Courier New'; color:#808080;"># make paramount = 0 if it is empty<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_paramount = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;">### </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: find object in hole database -&gt; change parent_id<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">text_to_find = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.find_entry.get_text().decode(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;utf-8&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)  </span><span style=" font-family:'Courier New'; color:#808080;"># take text from textview<br /><br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d_all = </span><span style=" font-family:'Courier New'; color:#8888c6;">dict</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br /><br />        l_name = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()                     </span><span style=" font-family:'Courier New'; color:#808080;"># list to find objects<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">l_name.append(text_to_find)<br />        l_d = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br /><br /><br />        </span><span style=" font-family:'Courier New'; color:#808080;"># if root is not None -&gt; use in select<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">entry = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.get_child()<br />        paramount_item = entry.get_text()<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># print(str(self.id_paramount) + &quot; &quot; + str(paramount_item))<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_paramount==</span><span style=" font-family:'Courier New'; color:#6897bb;">0 </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">and not </span><span style=" font-family:'Courier New'; color:#a9b7c6;">paramount_item == </span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&quot;</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.id_root == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_paramount):<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.b_root == </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:                </span><span style=" font-family:'Courier New'; color:#808080;"># not use root items<br />                    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d_all[c.id] = c.c_item  </span><span style=" font-family:'Courier New'; color:#808080;"># take all data in database<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select():<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.b_root == </span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:                </span><span style=" font-family:'Courier New'; color:#808080;"># not use root items<br />                    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d_all[c.id] = c.c_item  </span><span style=" font-family:'Courier New'; color:#808080;"># take all data in database<br />                </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d_all[c.id] = c.c_item          </span><span style=" font-family:'Courier New'; color:#808080;"># take all data in database<br /><br />        # print(d_all)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">k</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">v </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d_all.items():              </span><span style=" font-family:'Courier New'; color:#808080;"># combine list of values from dictionary<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">l_d.append(v)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">i </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_d)):<br />            set_d = </span><span style=" font-family:'Courier New'; color:#8888c6;">set</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_d[i])  </span><span style=" font-family:'Courier New'; color:#808080;"># set of each element of dictionary<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">j </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#8888c6;">range</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_name)):<br />                set_l = </span><span style=" font-family:'Courier New'; color:#8888c6;">set</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_name[j])<br />                inter = set_d.intersection(set_l)<br />                </span><span style=" font-family:'Courier New'; color:#808080;">l_i </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= </span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(inter)<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(inter) == </span><span style=" font-family:'Courier New'; color:#8888c6;">len</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">set</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(l_name[j])):<br />                    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">k</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">v </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">d_all.items():<br />                        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">v == l_d[i]:<br />                            res = k  </span><span style=" font-family:'Courier New'; color:#808080;"># take key<br />                            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.is_root(</span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(res)):<br />                                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.rewrite_class_data(</span><span style=" font-family:'Courier New'; color:#8888c6;">int</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(res))<br />                                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.write_cont()<br />                                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_to_update = </span><span style=" font-family:'Courier New'; color:#8888c6;">True </span><span style=" font-family:'Courier New'; color:#808080;"># if it is -&gt; just update<br />                            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.have_previous(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous):<br />                                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.set_visible(</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />                            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />                                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.hide()<br />                            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous == </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />                                </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_up.hide()<br />                            </span><span style=" font-family:'Courier New'; color:#808080;"># self.test_print()<br />                            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return<br /><br /><br />    </span><span style=" font-family:'Courier New'; color:#808080;">#### functions for work with SQLite<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">cur_level</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Define level of current object<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> n_id: id of current object<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">: id parent<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            c = Chain.get(Chain.id == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.n_cur)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level = c.id_parent<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">pass<br /><br />    def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">sel_max</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Take maximum id for current level<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">: None<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: rewrite for use in multi tree structure<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">query = Chain.select(fn.max(Chain.id)).where(Chain.id_parent == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">query.count()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">sel_min</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Take maximum id for current level<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">: None<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#808080;"># </span><span style=" font-family:'Courier New'; font-style:italic; color:#a8c023;">TODO: rewrite for use in multi tree structure<br />        </span><span style=" font-family:'Courier New'; color:#808080;">query </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= Chain.select(fn.min(Chain.id)).where(Chain.id_parent == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.id_parent == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level).order_by(Chain.id.asc()):<br />            res = c.id<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">res<br /><br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">insert_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; color:#808080;">### insert &amp; update text in controls<br /><br />        tree_iter </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.get_active_iter()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            entry = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.get_child()<br />            cv_item = entry.get_text()      </span><span style=" font-family:'Courier New'; color:#808080;"># text from ListStore - ComboBox<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">idv_parent = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">idv_previous = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#808080;"># insert data<br />            </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.create(</span><span style=" font-family:'Courier New'; color:#aa4926;">id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=next_id(Chain)</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">c_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=cv_item</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=idv_parent</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=idv_previous</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_next </span><span style=" font-family:'Courier New'; color:#a9b7c6;">= -</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">b_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_store.append([</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">cv_item])<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">pass<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">insert_row_entry</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function insert row into DB from entry-editor<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.create(</span><span style=" font-family:'Courier New'; color:#aa4926;">id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=next_id(Chain)</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">c_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text()</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">b_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">False</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">insert_row_entry_rewrite</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function insert row into DB from entry-editor<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> button:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> data:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.create(</span><span style=" font-family:'Courier New'; color:#aa4926;">id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=next_id(Chain)</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">c_item</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text()</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">id_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#aa4926;">b_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">=</span><span style=" font-family:'Courier New'; color:#8888c6;">False</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_roots</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function take list of roots<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">l = </span><span style=" font-family:'Courier New'; color:#8888c6;">list</span><span style=" font-family:'Courier New'; color:#a9b7c6;">()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.b_root==</span><span style=" font-family:'Courier New'; color:#8888c6;">True</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />                l.append(c.c_item)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">pass<br />        return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">l<br /><br />    </span><span style=" font-family:'Courier New'; color:#808080;"># определение id_root<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_id_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Function set id of root<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">entry = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.name_combo.get_child()<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.root = entry.get_text()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.c_item == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.root</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.b_root == </span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root = c.id<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level = c.id<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous = </span><span style=" font-family:'Courier New'; color:#6897bb;">0<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next = -</span><span style=" font-family:'Courier New'; color:#6897bb;">1<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.b_root = </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />            </span><span style=" font-family:'Courier New'; color:#808080;"># set paramount id of chosen root<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_paramount = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return<br /><br />    </span><span style=" font-family:'Courier New'; color:#808080;"># скрываем данные в контроллах<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">empty_controlls</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Make empty controlls<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">text = </span><span style=" font-family:'Courier New'; color:#008080;">u&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(text)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev.set_label(text)<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(text)<br /><br />    </span><span style=" font-family:'Courier New'; color:#808080;"># Фунции записи контроллов<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_cont_first</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Запись контроллов при первичной загрузке<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()      </span><span style=" font-family:'Courier New'; color:#808080;"># очищаем контроллы<br /><br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.get_text_of_id(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id))<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.get_text_of_id(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next))<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">write_cont</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Запись контроллов по текущим параметрам экземпляра<br />        self.id<br />        self.id_next<br />        self.id_previous<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.empty_controlls()  </span><span style=" font-family:'Courier New'; color:#808080;"># очищаем контроллы<br /><br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.set_text(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.get_text_of_id(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id))<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_next.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.get_text_of_id(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_next))<br />        </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.l_prev.set_label(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.get_text_of_id(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous))<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">get_text_of_id</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Определение текста по id<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == </span><span style=" font-family:'Courier New'; color:#6897bb;">0 </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">or </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == -</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:       </span><span style=" font-family:'Courier New'; color:#808080;"># если id пустое то возвращаем пустую запись<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c = Chain.get(Chain.id == id_item)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.c_item<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">have_next</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Определение наличия следующего элемента<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c = Chain.get(Chain.id == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.id_next &gt; </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">True<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">have_previous</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Определение наличия предыдущего элемента<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item==</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br /><br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.id == id_item):<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.id_previous &gt; </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">True<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">have_parent</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Определение наличия предка<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item==</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br />        c = Chain.select().where(Chain.id == id_item)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.id_parent &gt; </span><span style=" font-family:'Courier New'; color:#6897bb;">0</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">True<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">have_child</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_parent_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Определение наличия потомков<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_parent_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_parent_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br />        c = Chain.select().where(Chain.id_root == </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">and </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.id_parent == id_parent_item).order_by(<br />                Chain.id.asc())<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">True<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">take_first_child</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_root_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_parent_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Определение id 1-ого потомка<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_root_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_root_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_parent_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_parent_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_parent<br />        c = Chain.select().where(Chain.id_root == id_root_item </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">and </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.id_parent == id_parent_item).order_by(<br />                Chain.id.asc()).limit(</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">)<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.id<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">is_last</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_root_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_parent_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Define current item is last in this level<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_root_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_root_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_parent_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_parent_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_parent<br />        query = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.select(fn.max(Chain.id)).where(Chain.id_root == id_root_item </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">and </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.id_parent == id_parent_item).order_by(<br />                Chain.id.desc())<br />        </span><span style=" font-family:'Courier New'; color:#808080;">#max = query.count()<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id == query.count():<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">True<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">else</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">is_root</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Define is id_item root<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> id_item:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.b_root==</span><span style=" font-family:'Courier New'; color:#6897bb;">1</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.id == id_item:<br />                </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">True<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#8888c6;">False<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">select_first_child</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item=</span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Return id of first child item<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:param</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;"> id_item:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">id_item == </span><span style=" font-family:'Courier New'; color:#8888c6;">None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            id_item = </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">for </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">in </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Chain.select().where(Chain.id_parent == id_item).order_by(Chain.id.asc()):<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id) + </span><span style=" font-family:'Courier New'; color:#a5c261;">&quot; &quot; </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(c.id))<br />            </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">return </span><span style=" font-family:'Courier New'; color:#a9b7c6;">c.id<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">quit</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">button=0</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#808080;">data=None</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Rewrite data and quit from application<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if not </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.entry.get_text() == </span><span style=" font-family:'Courier New'; color:#a5c261;">''</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />            </span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.insert_or_update_row()     </span><span style=" font-family:'Courier New'; color:#808080;"># update current row<br /><br />        </span><span style=" font-family:'Courier New'; color:#a9b7c6;">Gtk.main_quit()<br /><br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">def </span><span style=" font-family:'Courier New'; font-weight:600; color:#a9b7c6;">test_print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">):<br />        </span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">&quot;&quot;&quot;<br />        Test output data function<br />        </span><span style=" font-family:'Courier New'; font-weight:600; font-style:italic; color:#629755;">:return</span><span style=" font-family:'Courier New'; font-style:italic; color:#629755;">:<br />        &quot;&quot;&quot;<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;self.id - &quot; </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id))<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;self.id_root - &quot; </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_root))<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;self.id_level - &quot; </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_level))<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;self.id_previous - &quot; </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous))<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">print</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;self.id_next - &quot; </span><span style=" font-family:'Courier New'; color:#a9b7c6;">+ </span><span style=" font-family:'Courier New'; color:#8888c6;">str</span><span style=" font-family:'Courier New'; color:#a9b7c6;">(</span><span style=" font-family:'Courier New'; color:#94558d;">self</span><span style=" font-family:'Courier New'; color:#a9b7c6;">.id_previous))<br /><br /><br /><br /><br /><br /><br /></span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">if </span><span style=" font-family:'Courier New'; color:#a9b7c6;">__name__ == </span><span style=" font-family:'Courier New'; color:#a5c261;">'__main__'</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">try</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />        Chain.create_table()            </span><span style=" font-family:'Courier New'; color:#808080;"># создаем таблицу<br />    </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">except</span><span style=" font-family:'Courier New'; color:#a9b7c6;">:<br />        </span><span style=" font-family:'Courier New'; font-weight:600; color:#cc7832;">pass<br />    </span><span style=" font-family:'Courier New'; color:#808080;">#try:<br />    #    test_insert()<br />    #except:<br />    #    pass<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">win = HeaderBarWindow()<br />    </span><span style=" font-family:'Courier New'; color:#808080;">#win.connect(&quot;delete-event&quot;, Gtk.main_quit)<br />    </span><span style=" font-family:'Courier New'; color:#a9b7c6;">win.connect(</span><span style=" font-family:'Courier New'; color:#a5c261;">&quot;delete-event&quot;</span><span style=" font-family:'Courier New'; color:#cc7832;">, </span><span style=" font-family:'Courier New'; color:#a9b7c6;">win.quit)<br />    win.show_all()<br />    Gtk.main()<br /></span></pre></body></html>